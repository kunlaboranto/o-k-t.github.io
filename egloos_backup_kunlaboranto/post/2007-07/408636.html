<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[펌] UDS (UNIX 도메인소켓) 을 이용한 IPC</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2007-07-12 15:56:27</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[펌] UDS (UNIX 도메인소켓) 을 이용한 IPC</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">From : <a href="http://www.joinc.co.kr/modules/moniwiki/wiki.php/article/UNIX%20%B5%B5%B8%DE%C0%CE%BC%D2%C4%CF%C0%BB%20%C0%CC%BF%EB%C7%D1%20IPC">http://www.joinc.co.kr/modules/moniwiki/wiki.php/article/UNIX%20%B5%B5%B8%DE%C0%CE%BC%D2%C4%CF%C0%BB%20%C0%CC%BF%EB%C7%D1%20IPC</a><br><div><br><br>Unix Domain Socket(이하 UDS) 는 socket API를 수정없이 이용며, <br>port 기반의 Inernet Domain Socket에 비해서 로컬 시스템의 파일시스템을 <br>이용해서 내부프로세스간의 통신을 위해 사용한다는 점이 다르다고 할수 있다. <br><br>ls 를 이용해서 통신을 위해서 만들어진 파일을 보면 다음과 같은 모습을 <br>보인다.<br><table width="100%"><tbody><tr><td bgcolor="#e0e0e0"><br><pre>[yundream@localhost tmp]$ ls -al<br>srwx------    1 root     nobody          0 12월 14 21:16 .fam_socket<br></pre><br></td></tr><br></tbody></table><br>보면 파일타입에 "s" 가 붙어 있는걸 알수 있으며, 파일사이즈가 0으로 되어 있는<br>걸 알수 있다. 왜냐하면 FIFO와 마찬가지로 메시지가 파일로 쌓이지 않고 <br>커널로 전달되어서 커널에서 처리하기 때문이다.<br><br><br>파일을 통해서 통신을 하며, 커널내부에서 메시지를 관리한다는 점에서 <br>FIFO와 매우 유사한면을 보여주지만, FIFO와는 달리 양방향 통신이 가능하다는 <br>특징을 가지고 있다. 그러므로 다중의 클라이언트를 받아들이는 서버/클라이언트 <br>모델을 만들기가 매우 쉽다.<br><br>또한 Inet 소켓을 통한 외부통신에 비해서 2배 이상의 효율을 보여준다라는 <br>장점을 가지고 있다. <br><br><br>많은 경우 약간 복잡한 내부프로세스간 통신을 해야된다고 했을때 UDS을 많이 <br>사용한다. INET 계층에서의 통신이 TCP/IP 4계층을 모두 거치는것과는 <br>다르게, UDS 은 어플리케이션 계층에서 TCP 계층까지만 메시지가 전달되고, <br>다시 곧바로 어플리케이션 계층으로 메시지가 올라가게 된다. TCP/IP 계층에 대한 <br>자세한 내용은 <a href="http://www.joinc.co.kr/article.php?sid=33">TCP/IP </a><a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=%EA%B0%9C%EC%9A%94">개요</a>(2)를 참고 하기 바란다.<br><br><br><br>위에서 INET 소켓보다 2배이상의 효율을 가진다고 했는데, <br>4계층의 레이어를 모두 거쳐야하는 INET 소켓에 비해서 단지 2개의 레이어만 <br>사용한다는 점도 그 이유중 하나로 작용한다.<br><br><br>쏘쓰 코드는 <a href="http://www.joinc.co.kr/modules.php?name=News&amp;file=article&amp;sid=20">다중연결서버 </a><a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=%EB%A7%8C%EB%93%A4%EA%B8%B0">만들기</a>(1)의 zipcode_multi.c 와 <br><a href="http://www.joinc.co.kr/article.php?sid=11">셈플로 알아보는 </a><a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=%EC%86%8C%EC%BC%93%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D">소켓프로그래밍</a>(1)의 zipcode_cli.c 를 사용하도록할것이다.<br><br><b>예제: zipcode_local.c</b><br><table width="100%"><tbody><tr><td bgcolor="#e0e0e0"><br><pre><span style="COLOR: #00b800">#include</span> &lt;sys/types.h&gt; <br><br><span style="COLOR: #00b800">#include</span> &lt;sys/stat.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;sys/socket.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;sys/un.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;unistd.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;stdio.h&gt; <br><br><span style="COLOR: #00b800">#include</span> &lt;stdlib.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;string.h&gt; <br><br><b><span style="COLOR: #0000ff">int</span></b> main(<b><span style="COLOR: #0000ff">int</span></b> argc, <b><span style="COLOR: #0000ff">char</span></b> **argv)<br>{<br>    <b><span style="COLOR: #0000ff">int</span></b> server_sockfd, client_sockfd;<br>    <b><span style="COLOR: #0000ff">int</span></b> state, client_len;<br>    pid_t pid;<br><br>    FILE *fp;<br>    <b><span style="COLOR: #0000ff">struct</span></b> sockaddr_un clientaddr, serveraddr;<br><br>    <b><span style="COLOR: #0000ff">char</span></b> buf[<span style="COLOR: #a900a9">255</span>];<br>    <b><span style="COLOR: #0000ff">char</span></b> line[<span style="COLOR: #a900a9">255</span>];<br><br>    <b><span style="COLOR: #0000ff">if</span></b> (argc != <span style="COLOR: #a900a9">2</span>)<br>    {<br>        printf(<span style="COLOR: #ff0000">"Usage : ./zipcode [file_name]\n"</span>);<br>        printf(<span style="COLOR: #ff0000">"예 : ./zipcode /tmp/mysocket\n"</span>); <br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }<br><br>    memset(line, '<span style="COLOR: #a900a9">0</span>', <span style="COLOR: #a900a9">255</span>);<br>    state = <span style="COLOR: #a900a9">0</span>;<br><br>    <b><span style="COLOR: #0000ff">if</span></b> (access(argv[<span style="COLOR: #a900a9">1</span>], F_OK) == <span style="COLOR: #a900a9">0</span>)<br>    {<br>        unlink(argv[<span style="COLOR: #a900a9">1</span>]);<br>    }<br>    // 주소 파일을 읽어들인다. <br>    client_len = <b><span style="COLOR: #0000ff">sizeof</span></b>(clientaddr);<br>    <b><span style="COLOR: #0000ff">if</span></b>((fp = fopen(<span style="COLOR: #ff0000">"zipcode.txt"</span>, <span style="COLOR: #ff0000">"r"</span>)) == NULL)<br>    {<br>        perror(<span style="COLOR: #ff0000">"file open error : "</span>);<br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }<br><br>    // internet 기반의 스트림 소켓을 만들도록 한다. <br>    <b><span style="COLOR: #0000ff">if</span></b> ((server_sockfd = socket(AF_UNIX, SOCK_STREAM, <span style="COLOR: #a900a9">0</span>)) &lt; <span style="COLOR: #a900a9">0</span>)<br>    {<br>        perror(<span style="COLOR: #ff0000">"socket error : "</span>);<br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }<br>    bzero(&amp;serveraddr, <b><span style="COLOR: #0000ff">sizeof</span></b>(serveraddr));<br>    serveraddr.sun_family = AF_UNIX;<br>    strcpy(serveraddr.sun_path, argv[<span style="COLOR: #a900a9">1</span>]);<br><br><br>    state = bind(server_sockfd , (<b><span style="COLOR: #0000ff">struct</span></b> sockaddr *)&amp;serveraddr, <br>            <b><span style="COLOR: #0000ff">sizeof</span></b>(serveraddr));<br>    <b><span style="COLOR: #0000ff">if</span></b> (state == -<span style="COLOR: #a900a9">1</span>)<br>    {<br>        perror(<span style="COLOR: #ff0000">"bind error : "</span>);<br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }<br><br>    state = listen(server_sockfd, <span style="COLOR: #a900a9">5</span>);<br>    <b><span style="COLOR: #0000ff">if</span></b> (state == -<span style="COLOR: #a900a9">1</span>)<br>    {<br>        perror(<span style="COLOR: #ff0000">"listen error : "</span>);<br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }<br><br><br>    printf(<span style="COLOR: #ff0000">"accept : \n"</span>);<br>    <b><span style="COLOR: #0000ff">while</span></b>(<span style="COLOR: #a900a9">1</span>)<br>    {<br>        client_sockfd = accept(server_sockfd, (<b><span style="COLOR: #0000ff">struct</span></b> sockaddr *)&amp;clientaddr, <br>                               &amp;client_len);<br>        printf(<span style="COLOR: #ff0000">"test test\n"</span>);<br>        pid = <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=fork">fork</a>();<br>        <b><span style="COLOR: #0000ff">if</span></b> (pid == <span style="COLOR: #a900a9">0</span>)<br>        {<br>            <b><span style="COLOR: #0000ff">if</span></b> (client_sockfd == -<span style="COLOR: #a900a9">1</span>)<br>            {<br>                perror(<span style="COLOR: #ff0000">"Accept error : "</span>);<br>                exit(<span style="COLOR: #a900a9">0</span>);<br>            }<br>            <b><span style="COLOR: #0000ff">while</span></b>(<span style="COLOR: #a900a9">1</span>)<br>            {<br>                memset(buf, '<span style="COLOR: #a900a9">0</span>', <span style="COLOR: #a900a9">255</span>);<br>                <b><span style="COLOR: #0000ff">if</span></b> (read(client_sockfd, buf, <span style="COLOR: #a900a9">255</span>) &lt;= <span style="COLOR: #a900a9">0</span>)<br>                {<br>                    <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=close">close</a>(client_sockfd);<br>                    <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=fclose">fclose</a>(fp);<br>                    exit(<span style="COLOR: #a900a9">0</span>);<br>                }<br><br>                <b><span style="COLOR: #0000ff">if</span></b> (strncmp(buf, <span style="COLOR: #ff0000">"quit"</span>,<span style="COLOR: #a900a9">4</span>) == <span style="COLOR: #a900a9">0</span>)<br>                {<br>                    write(client_sockfd, <span style="COLOR: #ff0000">"bye bye\n"</span>, <span style="COLOR: #a900a9">8</span>);  <br>                    <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=close">close</a>(client_sockfd);<br>                    <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=fclose">fclose</a>(fp);<br>                    <b><span style="COLOR: #0000ff">break</span></b>;<br>                }<br><br>                <b><span style="COLOR: #0000ff">while</span></b>(fgets(line,<span style="COLOR: #a900a9">255</span>,fp) != NULL)<br>                {<br>                    <b><span style="COLOR: #0000ff">if</span></b> (<a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=strstr">strstr</a>(line, buf) != NULL)<br>                        write(client_sockfd, line, <span style="COLOR: #a900a9">255</span>);<br>                    memset(line, '<span style="COLOR: #a900a9">0</span>', <span style="COLOR: #a900a9">255</span>);<br>                }<br>                write(client_sockfd, <span style="COLOR: #ff0000">"end"</span>, <span style="COLOR: #a900a9">255</span>);<br>                printf(<span style="COLOR: #ff0000">"send end\n"</span>);<br>                <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=rewind">rewind</a>(fp);<br>            }<br>        }<br>    }<br>    <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=close">close</a>(client_sockfd);<br>}<br><br></pre><br></td></tr><br></tbody></table><br><br>다음은 클라이언트 프로그램이다.<br><br><b>예제: zipcode_cli_local.c</b><br><table width="100%"><tbody><tr><td bgcolor="#e0e0e0"><br><pre><span style="COLOR: #00b800">#include</span> &lt;sys/types.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;sys/stat.h&gt; <br><br><span style="COLOR: #00b800">#include</span> &lt;sys/socket.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;unistd.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;sys/un.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;stdio.h&gt; <br><span style="COLOR: #00b800">#include</span> &lt;stdlib.h&gt; <br><br><span style="COLOR: #00b800">#include</span> &lt;string.h&gt; <br><br><br><b><span style="COLOR: #0000ff">int</span></b> main(<b><span style="COLOR: #0000ff">int</span></b> argc, <b><span style="COLOR: #0000ff">char</span></b> **argv)<br>{<br><br>    <b><span style="COLOR: #0000ff">int</span></b> client_len;<br>    <b><span style="COLOR: #0000ff">int</span></b> client_sockfd;<br><br>    FILE *fp_in;<br>    <b><span style="COLOR: #0000ff">char</span></b> buf_in[<span style="COLOR: #a900a9">255</span>];<br>    <b><span style="COLOR: #0000ff">char</span></b> buf_get[<span style="COLOR: #a900a9">255</span>];<br><br>    <b><span style="COLOR: #0000ff">struct</span></b> sockaddr_un clientaddr;<br><br>    <b><span style="COLOR: #0000ff">if</span></b> (argc != <span style="COLOR: #a900a9">2</span>)<br>    {       <br>        printf(<span style="COLOR: #ff0000">"Usage : ./zipcode_cl [file_name]\n"</span>);<br>        printf(<span style="COLOR: #ff0000">"예 : ./zipcode_cl /tmp/mysocket\n"</span>);<br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }       <br><br><br>    client_sockfd = socket(AF_UNIX, SOCK_STREAM, <span style="COLOR: #a900a9">0</span>);<br>    <b><span style="COLOR: #0000ff">if</span></b> (client_sockfd == -<span style="COLOR: #a900a9">1</span>)<br>    {<br>        perror(<span style="COLOR: #ff0000">"error : "</span>);<br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }<br>    bzero(&amp;clientaddr, <b><span style="COLOR: #0000ff">sizeof</span></b>(clientaddr));<br>    clientaddr.sun_family = AF_UNIX;<br>    strcpy(clientaddr.sun_path, argv[<span style="COLOR: #a900a9">1</span>]);<br>    client_len = <b><span style="COLOR: #0000ff">sizeof</span></b>(clientaddr);<br>    <b><span style="COLOR: #0000ff">if</span></b> (connect(client_sockfd, (<b><span style="COLOR: #0000ff">struct</span></b> sockaddr *)&amp;clientaddr, client_len) &lt; <span style="COLOR: #a900a9">0</span>)<br>    {<br>        perror(<span style="COLOR: #ff0000">"Connect error: "</span>);<br>        exit(<span style="COLOR: #a900a9">0</span>);<br>    }<br>    <b><span style="COLOR: #0000ff">while</span></b>(<span style="COLOR: #a900a9">1</span>)<br>    {<br>        printf(<span style="COLOR: #ff0000">"지역이름 입력 : "</span>);<br>        fgets(buf_in, <span style="COLOR: #a900a9">255</span>,stdin);<br><br>        <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=buf_in%5Bstrlen">buf_in[strlen</a>(buf_in) - <span style="COLOR: #a900a9">1</span>] = '<span style="COLOR: #a900a9">0</span>';<br>        write(client_sockfd, buf_in, <span style="COLOR: #a900a9">255</span>);<br>        <b><span style="COLOR: #0000ff">if</span></b> (strncmp(buf_in, <span style="COLOR: #ff0000">"quit"</span>, <span style="COLOR: #a900a9">4</span>) == <span style="COLOR: #a900a9">0</span>)<br>        {<br>            <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=close">close</a>(client_sockfd);<br>            exit(<span style="COLOR: #a900a9">0</span>);<br>        }<br>        <b><span style="COLOR: #0000ff">while</span></b>(<span style="COLOR: #a900a9">1</span>)<br>        {<br>            read(client_sockfd, buf_get, <span style="COLOR: #a900a9">255</span>); <br>            <b><span style="COLOR: #0000ff">if</span></b> (strncmp(buf_get, <span style="COLOR: #ff0000">"end"</span>, <span style="COLOR: #a900a9">3</span>) == <span style="COLOR: #a900a9">0</span>)<br>                <b><span style="COLOR: #0000ff">break</span></b>;<br><br>            printf(<span style="COLOR: #ff0000">"%s"</span>, buf_get);<br>        }<br>    }<br><br>    <a href="http://www.egloos.com/modules/moniwiki/wiki.php/manSearch?google=none&amp;name=close">close</a>(client_sockfd);<br>    exit(<span style="COLOR: #a900a9">0</span>);<br>}<br><br></pre><br></td></tr><br></tbody></table><br><br>기존의 INET 버젼의 프로그램과 비교해 보면 고작 3줄 정도만 수정되었음을 <br>알수 있을것이다. 단지 소켓 구조체가 sockaddr_un 으로 바뀌고, <br>AF_INET 대신 AF_UNIX 를 그리고 port 번호대신에 파일명을 사용했음을 <br>알수 있다.<br><br>나머지의 모든 코드는 INET 코드와 완전히 같다. 그러므로 <br>Unix Domain Socket 를 사용하면 Inet Domain Socket 와 코드 일관성을 <br>유지할수 있으며, 동일한 기술을 사용해서 프로그래밍을 할수 있다. <br><br>또한 다른 대부분의 IPC 설비들이, 범용적으로 사용하기에는 부족한 여러가지 <br>단점들을 가진반면(단방향 이거나, 읽기만 가능하다거나, 제어하기가 어려운) <br>UDS는 매우 범용적인 IPC 로써 사용가능하다라는 장점을 가지고 있다.<br><br>실제로 X 서버 같은경우에 외부에서의 접근시에는 INET 연결을 내부에서의 <br>연결을 위해서는 UDS 를 사용한다. 이밖에도 mysql, pgsql, KDE, Gnome 과 같은 <br>대부분의 서버프로그램이 내부통신을 위해서 UDS 를 사용한다. <br><div class="adsense">&nbsp;</div></div></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
