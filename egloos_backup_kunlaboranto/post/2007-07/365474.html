<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>pread, pwrite 성능 문제</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2007-07-02 14:17:37</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">pread, pwrite 성능 문제</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">BUG-17594<br><br>&nbsp;&nbsp;&nbsp;현재&nbsp;pread나&nbsp;pwrite가&nbsp;없는&nbsp;platform은&nbsp;PD&nbsp;layer에서&nbsp;구현된&nbsp;pread,&nbsp;pwrite를쓰는데 <br>&nbsp;&nbsp;&nbsp;문제는 <br>&nbsp;&nbsp;&nbsp;PDL_OS_GUARD를&nbsp;써서&nbsp;구현하고&nbsp;있습니다. <br>&nbsp;&nbsp;&nbsp;예를&nbsp;들면&nbsp; <br>&nbsp;&nbsp;&nbsp;pread() <br>&nbsp;&nbsp;&nbsp;{ <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PDL_OS_GUARD&nbsp;&lt;--하나의&nbsp;Thread만이&nbsp;이&nbsp;함수에&nbsp;들어오독&nbsp;함. <br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <br>&nbsp;&nbsp;&nbsp;} <br><br>&nbsp;&nbsp;&nbsp;결국&nbsp;IO를&nbsp;Disk단으로&nbsp;분리하더라도&nbsp;이&nbsp;함수를&nbsp;쓰는&nbsp;한&nbsp;모든&nbsp;이&nbsp;함수에서&nbsp;대기하게되는 <br>&nbsp;&nbsp;&nbsp;문제가&nbsp;있습니다. <br><br>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br><br>From : <a href="http://kldp.org/node/81642">http://kldp.org/node/81642</a><br><br><br><h1 class="title"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">멀티 쓰레드 환경에서 파일 락(lock)은 일반적으로 어떻게 코드를 짜는 건지 궁금합니다.</span></span></span></h1><span style="FONT-SIZE: 100%">Q.<br></span><p>1개의 파일에 여러개의 쓰레드가 접근해서 메세지를 기록해야 합니다.<br>유닉스, 리눅스 맨 페이지에 보면 fopen()이 thread safe 하다고 나와 있습니다.<br>그래서 크게 신경쓰기 않고 코드를 만들면 됩니다.</p><p>하지만 MSDN에는 도통 그런말을 찾아볼 수가 없네요.<br>여러 OS에서 동작가능하게끔 만들고 있기 때문에 윈도우즈 환경에서도 구동될 수 있게 해야 하는데, 난감하네요.</p><p>파일별로 뮤텍스를 만들고 관리하는 방법 밖에 없는 건가요?<br>이런 경우 일반적으로 어떻게 하는지 궁금합니다.</p><br>A. <br><p>필요할 때 마다 fopen(), write, fclose() 하는 방식인가요 ?</p><p>그렇지 않다면... 어떤 파일에 대한 FILE * 을 모든 쓰레드가 공유하는 편이 더 좋습니다. 한 쓰레드가 변화시킨 offset 이 다른 쓰레드에도 즉각적으로 반영됩니다. fopen() 이후에 외부에서 파일의 내용이 변경됐을 경우에도 fseek() 가 잘 작동하는 지는 모르겠습니다만, 분명한 것은 seek와 read/write 가 분리되는 경우는 무조건 thread-unsafe 라는 겁니다. 오죽하면 pread(), pwrite() 가 나왔을까요.</p><p>FILE * 을 쓰레드가 공유하는 방식이라면 FILE * 과 뮤텍스를 포함하는 자료구조를 설계하고, 구현하시면 쉬울 것 같습니다. OS 별로 찢기에도 편할 것 같고, 언어(컴파일러?)에도 비교적 독립적으로 될 것 같기도 하고.</p><br>++++++++++++<br><br>From : <a href="http://kldp.org/node/62751">http://kldp.org/node/62751</a><br><br><h1 class="title"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">파일 디스크립터에 임의 포인터를 붙여줄 수 있을까요?</span></span></span></h1><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">..</span><br></span><p>저도 그 sigval 로 어떻게 할 수 없나 생각해봤는데요... sigqueue 로 전달한 것이 아니고, I/O 시그널이 발생했을 때에도 sigval 을 전달할 수 있는 방법이 필요하거든요. 혹시 방법이 있는지요?</p><p>제 질문이 모호하다면, 다음 사이트를 참조해주세요.</p><p><a title="http://www.thinkage.ca/english/gcos/expl/c/lib/filept.html" href="http://www.thinkage.ca/english/gcos/expl/c/lib/filept.html">http://www.thinkage.ca/english/gcos/expl/c/lib/filept.html</a></p><br><br><h3 class="title"><a class="active" href="http://kldp.org/node/62751#comment-275837">fileptr()은 비표준화 함수입니다.</a></h3><div class="submitted">Submitted by <a title="사용자 프로필 보기" href="http://kldp.org/user/1652">sunyzero</a> on 월, 2006/01/16 - 1:25am.</div><div class="content"><div class="vote-up-down-widget"><span class="up-inact" title="You must login to vote."></span><span class="down-inact" title="You must login to vote."></span></div><p>아, 제가 잘못이해했군요.</p><p>파일디스크립터로부터 스트림을 얻어오는 linkage channel 을 말씀하시는것 같습니다.</p><p>fd -&gt; FILE * 로 쓰실때는 fdopen()<br>FILE * -&gt; fd 로 쓰실때는 fileno() 를 쓰시면 됩니다.</p><p>fileptr()은 비표준화 함수이므로 쓰면 안됩니다. linkage channel 을 쓰실때는 파일커서위치가 스트림에 의해서 변경될 수 있기 때문에, 굳이 두가지를 혼용하신다면 왠만하면 파일디스크립터에 대해서는 pwrite(), pread() 계열을 사용하시기를 권장합니다.</p></div><br>++++++++++++<br><br>From : <a href="http://www.sourcentral.org/man/debian-unstable/ko/2+pread">http://www.sourcentral.org/man/debian-unstable/ko/2+pread</a><br><br><h1 align="center"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">PREAD</span></span></span></h1><a id="heading1" name="heading1"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">이름</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">pread, pwrite − 주어진 변위에서 파일 기술자에서 읽거나 파일 기술자에 쓴다.</span></span></span></p></td></tr></tbody></table><a id="heading2" name="heading2"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">사용법</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><b><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">#define _XOPEN_SOURCE 500</span></span></span></b></p><p><b><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">#include &lt;unistd.h&gt;</span></span></span></b></p><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><b>ssize_t pread(int</b> <i>fd</i><b>, void *</b><i>buf</i><b>, size_t</b> <i>count</i><b>, off_t</b> <i>offset</i><b>);</b></span></span></span></p><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><b>ssize_t pwrite(int</b> <i>fd</i><b>, const void *</b><i>buf</i><b>, size_t</b> <i>count</i><b>, off_t</b> <i>offset</i><b>);</b></span></span></span></p></td></tr></tbody></table><a id="heading3" name="heading3"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">설명</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><b>pread()</b> 는 파일 기술자 <i>fd</i> 의 변위 <i>offset</i> (파일의 시작에서) 에서 <i>count</i> 바이트를 <i>buf</i>로 시작하는 버퍼로 읽는다.</span></span></span></p><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><b>pwrite()</b> 는 <i>buf</i> 로 시작하는 버퍼를 파일 기술자 <i>fd</i> 의 변위 <i>offset</i>에다가 <i>count</i> 바이트를 쓴다. 파일 변위는 바뀌지 않는다.</span></span></span></p><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">The file referenced by <i>fd</i> 가 가리키는 파일은 이동할수 있어야 한다.</span></span></span></p></td></tr></tbody></table><a id="heading4" name="heading4"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">반환값</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">성공시, 읽거나 쓴 바이트 수가 반환된다.(<b>pwrite</b> 의 경우 0은 어떤 것도 쓰여지지 않았다는 것을 가리키며 <b>pread</b> 의 경우는 파일의 끝을 가리킨다.) 에러시 −1이 반환되며 <i>errno</i> 는 에러를 가리키도록 설정된다.</span></span></span></p></td></tr></tbody></table><a id="heading5" name="heading5"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">에러</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><b>pread</b> 는 실패할수 있고 <i>errno</i> 를 <b><a href="http://www.sourcentral.org/man/debian-unstable/ko/2+read">read(2)</a></b> 나 <b><a href="http://www.sourcentral.org/man/debian-unstable/ko/2+lseek">lseek(2)</a></b> 가 가리키는 어떤 에러로 설정할수 있다. <b>pwrite</b> 는 실패할수 있고 <i>errno</i> 를 <b><a href="http://www.sourcentral.org/man/debian-unstable/ko/2+write">write(2)</a></b> 나 <b><a href="http://www.sourcentral.org/man/debian-unstable/ko/2+lseek">lseek(2)</a></b>가 가리키는 어떤 에러로 설정할수 있다.</span></span></span></p></td></tr></tbody></table><a id="heading6" name="heading6"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">호환</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">Unix98</span></span></span></p></td></tr></tbody></table><a id="heading7" name="heading7"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">역사</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><b>pread</b> 와 <b>pwrite</b> 시스템 콜들은 버전 2.1.60 에서 추가되었다; i386 시스템 콜 테이블의 엔트리는 2.1.69 에 추가되었다. libc 지원은(시스템 콜 없이 예전 커널의 에뮬레이션을 포함하여) glibc2.1에서 <span style="FONT-SIZE: 85%">추가되었다</span>.</span></span></span></p></td></tr></tbody></table><a id="heading8" name="heading8"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">관련 항목</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><b><a href="http://www.sourcentral.org/man/debian-unstable/ko/2+read"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">read(2)</span></span></span></a></b><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">, <b><a href="http://www.sourcentral.org/man/debian-unstable/ko/2+write">write(2)</a></b>, <b><a href="http://www.sourcentral.org/man/debian-unstable/ko/2+lseek">lseek(2)</a></b></span></span></span></p></td></tr></tbody></table><a id="heading9" name="heading9"></a><h2><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">역자</span></span></span></h2><table cellspacing="0" cellpadding="0" rules="none" width="100%" border="0" frame="void"><tbody><tr valign="top" align="left"><td width="10%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"></span></span></span></td><td width="89%"><p><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%"><span style="FONT-SIZE: 100%">정강훈 &lt;skyeyes@soback.kornet.net&gt;, 2000년 9월 19일</span></span></span></p></td></tr></tbody></table></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
