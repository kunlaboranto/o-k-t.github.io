<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[펌] MSSQL 2005, pivot (가로) 연산</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2009-01-15 09:43:23</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[펌] MSSQL 2005, pivot (가로) 연산</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content"><b><a href="http://www.soqool.com/soqool/main/common/soqool_intro.jsp"><b>쏘쿨(SoQooL)이란?</b></a></b><br><br>&nbsp;11g의 pivot, unpivot 기능&nbsp;&nbsp; (Posted: 2008-04-18 14:31:55)&nbsp;&nbsp;&nbsp; 새창으로<br>&nbsp;&nbsp;&nbsp; by 김홍선&nbsp;&nbsp; (Posts: 2408 - Registered: 2006-04-15)<br>&nbsp;&nbsp;&nbsp; 11g 에서 드디어 pivot, unpivot 기능이 추가되었다.<br><br>아래 두 링크를 쫓아가보자.<br><br>Pivot과 Unpivot<br>http://www.oracle.com/technology/global/kr/pub/articles/oracle-database-11g-top-features/11g-pivot.html<br><br>Oracle Database 11g SQL Language Reference<br>http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/statements_10002.htm#CHDCEJJE<br><br><br>--------------------<br><br>From : http://www.sqlworld.pe.kr/mboard/mboard/mboard.asp?board_id=sql01&amp;group_name=board&amp;idx_num=18&amp;page=1&amp;category=&amp;search=&amp;b_cat=0&amp;order_c=idx_num&amp;order_da=desc<br><br><table width="100%" cellpadding="0" cellspacing="0"><tbody><tr><td class="Tahoma8" height="22">날짜 : 2006-09-06 오전 1:14:04<!--&nbsp;&nbsp;222.237.237.72-->&nbsp;&nbsp;추천 : <b>1</b>&nbsp;&nbsp;조회 : <b>2700</b>                    </td>                </tr>                <tr>                    <td>                        <table width="100%" bgcolor="white" cellpadding="0" cellspacing="1">                            <tbody><tr>                                <td colspan="2" bgcolor="#e3e3e3" height="1">                                <br></td>                            </tr>                            <tr>                                <td class="Tahoma8" width="120" bgcolor="#e3e3e3" height="26">                                    <p style="margin-right: 5px;" align="right"><b>이름</b></p>                                </td>                                <td class="Tahoma8" bgcolor="#f7f7f7" height="26">                               <p style="margin-left: 5px;"><a href="javascript:;" onmousedown="view_member_info('jangrae','18',event,'0','bestmct@sqlworld.pe.kr','www.sqlworld.pe.kr','sql01','board','이장래','0','0','0','1')">이장래</a></p>                                </td>                            </tr><!-- 홈페이지 주소가 존재하지 않는다면 숨김 -->                            <tr>                                <td class="Tahoma8" width="120" bgcolor="#e3e3e3" height="26">                                    <p style="margin-right: 5px;" align="right"><b>홈페이지</b></p>                                </td>                                <td class="Tahoma8" bgcolor="#f7f7f7" height="26">                                    <p style="margin-left: 5px;"><a href="http://www.sqlworld.pe.kr/" target="_blank">http://www.sqlworld.pe.kr</a></p>                                </td>                            </tr><!-- 홈페이지 주소가 존재하지 않는다면 숨김 --><!-- 첫번째 업로드 파일이 존재하지 않으면 숨김 -->                            <tr>                                <td class="Tahoma8" width="120" bgcolor="#e3e3e3" height="26">                                    <p style="margin-right: 5px;" align="right"><b>파일1</b></p>                                </td>                                <td class="Tahoma8" bgcolor="#f7f7f7" height="26">                                    <p style="margin-left: 5px;"><a href="http://www.sqlworld.pe.kr/mboard/mboard/filedown.asp?down_num=18&amp;board_id=sql01&amp;group_name=board&amp;c_num=18&amp;file=1">pivot.sql                                     &nbsp;(2 KB)</a>&nbsp;&nbsp;&nbsp;(전송횟수: 391)</p>                                </td>                            </tr><!-- 첫번재 업로드 파일이 존재하지 않으면 숨김 --><!-- 두번재 업로드 파일이 존재하지 않으면 숨김 --><!--                            <tr>                                <td height="26" bgcolor="#E3E3E3" width="120" class="Tahoma8">                                    <p style="margin-right:5;" align="right"><b>파일2</b></p>                                </td>                                <td height="26" bgcolor="#F7F7F7" class="Tahoma8">                                    <p style="margin-left:5;">                                     &nbsp;(0)&nbsp&nbsp&nbsp(전송횟수: 0)</p>                                </td>                            </tr>--><!-- 두번재 업로드 파일이 존재하지 않으면 숨김 --><!-- 첫번재 링크주소가 존재하지 않으면 숨김 --><!--                            <tr>                                <td height="26" bgcolor="#E3E3E3" width="120" class="Tahoma8">                                    <p style="margin-right:5;" align="right"><b>링크1</b></p>                                </td>                                <td height="26" bgcolor="#F7F7F7" class="Tahoma8">                                    <p style="margin-left:5;"><b></b></p>                                </td>                            </tr>--><!-- 첫번재 링크주소가 존재하지 않으면 숨김 --><!-- 두번재 링크주소가 존재하지 않으면 숨김 --><!--                            <tr>                                <td height="26" bgcolor="#E3E3E3" width="120" class="Tahoma8">                                    <p style="margin-right:5;" align="right"><b>링크2</b></p>                                </td>                                <td height="26" bgcolor="#F7F7F7" class="Tahoma8">                                    <p style="margin-left:5;"><b></b></p>                                </td>                            </tr>--><!-- 두번재 링크주소가 존재하지 않으면 숨김 -->                            <tr>                                <td class="Tahoma8" width="120" bgcolor="#e3e3e3" height="26">                                   <p style="margin-right: 5px;" align="right"><b>제목</b></p>                                </td>                                <td class="Tahoma8" bgcolor="#f7f7f7" height="26">                                    <p style="margin-left: 5px;"><b>제 2 장 : PIVOT 연산자</b></p>                                </td>                            </tr>                            <tr>                                <td colspan="2" bgcolor="#e3e3e3" height="1">                                <br></td>                            </tr>                        </tbody></table>                    </td>                </tr>                <tr>                    <td>                        <p>&nbsp;</p>                    </td>                </tr>                <tr>                    <td>                            <p style="margin-right: 20px;" align="right"><!--<img src="skin/board03/tomail.gif" width="37" height="13" border="0">--><a href="javascript:new_win('print_view.asp?board_id=sql01&amp;group_name=board&amp;idx_num=18','print_view','700','600','3')"><img src="http://www.sqlworld.pe.kr/mboard/mboard/skin/board03/print.gif" width="65" border="0" height="19"></a><a href="http://www.sqlworld.pe.kr/mboard/mboard/vote.asp?board_id=sql01&amp;group_name=board&amp;idx_num=18&amp;c_num=18&amp;page=1&amp;category=&amp;search=&amp;b_cat=0&amp;order_c=idx_num&amp;order_da=desc&amp;mode=view"><img src="http://www.sqlworld.pe.kr/mboard/mboard/skin/board03/vote.gif" width="65" border="0" height="19"></a></p>                    </td>                </tr><!-- 첫번째 업로드 파일을 실행할 수 없는 경우 숨김 --><!--                <tr>                    <td>                            <p>&nbsp;</p>                    </td>                </tr>                <tr>                    <td>                        <p align="center">no</p>                    </td>                </tr>--><!-- 첫번째 업로드 파일을 실행할 수 없는 경우 숨김 --><!-- 두번째 업로드 파일을 실행할 수 없는 경우 숨김 --><!--                <tr>                    <td>                        <p>&nbsp;</p>                    </td>                </tr>                <tr>                    <td>                        <p align="center"></p>                    </td>                </tr>--><!-- 두번째 업로드 파일을 실행할 수 없는 경우 숨김 -->                <tr>                    <td style="">                        <table style="line-height: 24px; margin-top: 0pt; margin-bottom: 0pt;" width="98%" align="center" cellpadding="0" cellspacing="0">                            <tbody><tr>                                <td>                                    <p>&nbsp;</p>                                </td>                            </tr>                            <tr>                                <td style=""><p style="margin: 0pt 5px; line-height: 24px;"><table class="normal" width="600" align="center" border="0" cellpadding="10" cellspacing="0">  <tbody><tr>     <td align="left">       <p align="left">앞의 강좌에서는 OUTPUT 키워드의 새로운 기능에 대해 알아보았습니다. 이번 강좌에서는 MS SQL Server 2005에서새롭게 선보인 PIVOT 연산자에 대해 살펴보도록 하겠습니다. PIVOT 연산자와 비교되는 것이 UNPIVOT 연산자 입니다.UNPIVOT 연산자는 다음 강좌에서 살펴 보도록 하겠습니다. </p>      <p align="left"><b><font color="#0000ff"><b><font color="#006600">1. PIVOT 연산자? </font></b></font></b></p>      <p align="left">PIVOT 연산자가 생소하게 들리는 분들도 있습니다. 이해를 돕기 위해 다음 그림을 살펴 보도록 하겠습니다.</p>      <p align="center"><img src="http://www.sqlworld.pe.kr/lecture2005/transql/pivot.jpg" width="578" height="272"> <br>      <b><font color="#330000">[그림 1] </font></b></p>      <p align="left">[그림 1]에서 왼쪽 테이블과 같은 결과값이 PIVOT 연산자를 통해 오른쪽 테이블과 같은 결과값으로 변형시키게 됩니다. 왼쪽테이블의 상품명의 결과 값인 '자전거'와 '카메라'가 오른쪽 결과 테이블에서는 '자전거'와 '카메라'라는 컬럼이 되었습니다.그리고 왼쪽 테이블의 수량 값이 오른쪽 테이블에는 고객별 '자전거'와 '카메라'에 대한 수량의 합으로 변해 있습니다. 이와 같이결과 값의 특정 부분을 컬럼으로 바꾸고 집계 합수를 통해 재계산된 값을 표시하는 것이 PIVOT 연산자입니다. 사용예를 보면서살펴보도록 하겠습니다. </p>      <p align="left"><b><font color="#0000ff"><b><font color="#006600">2. PIVOT 연산자 사용 예 </font></b></font></b></p>      <p align="left">간단한 예일 수 있지만 PIVOT 연산자의 사용 예를 살펴 보도록 하겠습니다. 우선 다음과 같이 [회원], [상품], [주문] 테이블을 만들고 값을 입력했습니다. </p>      <table class="script" width="580" align="center" bgcolor="#eaeaea" border="0" cellpadding="8" cellspacing="0">        <tbody><tr>          <td background="/images/script_top.gif" height="7"><br></td>        </tr>        <tr>          <td background="/images/script_ground.gif"><p>USE SQLWorld<br>            GO</p>            <p><font color="#009900">-- 회원 테이블 만들기</font></p>            <p>CREATE TABLE 회원 (<br>              회원번호 char(02) PRIMARY KEY,<br>              회원명 varchar(20)<br>              )</p>            <p><font color="#009900">-- 상품 테이블 만들기</font></p>            <p>CREATE TABLE 상품 (<br>              상품번호 char(02) PRIMARY KEY,<br>              상품명 varchar(20)<br>              )</p>            <p><font color="#009900">-- 주문 테이블 만들기</font></p>            <p>CREATE TABLE 주문 (<br>              주문번호 int PRIMARY KEY,<br>              회원번호 char(02),<br>              상품번호 char(02),<br>              수량 int<br>              )</p>            <p><font color="#009900">-- 데이터 입력</font></p>            <p><font color="#009900">-- 회원 정보 입력</font></p>            <p>INSERT INTO 회원 VALUES ('M1', '홍길동')<br>              INSERT INTO 회원 VALUES ('M2', '김주몽')<br>              INSERT INTO 회원 VALUES ('M3', '이장래')<br>              INSERT INTO 회원 VALUES ('M4', '한국인')<br>              INSERT INTO 회원 VALUES ('M5', '오감자')</p>            <p><font color="#009900">-- 상품정보 입력</font></p>            <p>INSERT INTO 상품 VALUES ('P1', '자전거')<br>              INSERT INTO 상품 VALUES ('P2', '카메라')<br>              INSERT INTO 상품 VALUES ('P3', '노트북')</p>            <p><font color="#009900">-- 주문 정보 입력</font></p>            <p>INSERT INTO 주문 VALUES (1, 'M1', 'P1', 1)<br>              INSERT INTO 주문 VALUES (2, 'M2', 'P2', 2)<br>              INSERT INTO 주문 VALUES (3, 'M3', 'P1', 1)<br>              INSERT INTO 주문 VALUES (4, 'M3', 'P1', 1)<br>              INSERT INTO 주문 VALUES (5, 'M2', 'P3', 1)<br>              INSERT INTO 주문 VALUES (6, 'M1', 'P2', 3)<br>              INSERT INTO 주문 VALUES (7, 'M3', 'P1', 1)<br>              INSERT INTO 주문 VALUES (8, 'M1', 'P1', 2)<br>              INSERT INTO 주문 VALUES (9, 'M2', 'P3', 1)<br>              INSERT INTO 주문 VALUES (10, 'M1', 'P2', 1)<br>              GO</p></td>        </tr>        <tr>          <td background="/images/script_bottom.gif" height="7"><br></td>        </tr>      </tbody></table>      <p align="left">이 상태에서 회원별 상품 주문 현황을 보려면 다음과 같이 수행하면 됩니다. </p>      <table class="script" width="580" align="center" bgcolor="#eaeaea" border="0" cellpadding="8" cellspacing="0">        <tbody><tr>          <td background="/images/script_top.gif" height="7"><br></td>        </tr>        <tr>          <td background="/images/script_ground.gif"><p><font color="#009900">-- 회원별+상품별 구매 정보</font></p>            <p>SELECT T2.회원명, T3.상품명, SUM(수량) 수량합<br>              FROM 주문 T1 <br>              INNER JOIN 회원 T2 ON T1.회원번호 = T2.회원번호<br>              INNER JOIN 상품 T3 ON T1.상품번호 = T3.상품번호<br>              GROUP BY T2.회원명, T3.상품명</p></td>        </tr>        <tr>          <td background="/images/script_bottom.gif" height="7"><br></td>        </tr>      </tbody></table>      <p align="left">위 쿼리문의 수행 결과는 다음과 같습니다. </p>      <table class="script" width="580" align="center" bgcolor="#eaeaea" border="0" cellpadding="8" cellspacing="0">        <tbody><tr>          <td background="/images/script_top.gif" height="7"><br></td>        </tr>        <tr>          <td background="/images/script_ground.gif"><pre>회원명               상품명               수량합<br>-------------------- -------------------- -----------<br>김주몽               노트북               2<br>이장래               자전거               3<br>홍길동               자전거               3<br>김주몽               카메라               2<br>홍길동               카메라               4<br>(5개 행 적용됨)</pre></td>        </tr>        <tr>          <td background="/images/script_bottom.gif" height="7"><br></td>        </tr>      </tbody></table>      <p align="left">위 결과를 상품명의 결과 값인 '노트북', '자전거', '카메라'를 컬럼으로 갖는 형태의 결과를 얻고자 한다면 다음과 같이 PIVOT 연산자를 활용하면 됩니다. </p>      <table class="script" width="580" align="center" bgcolor="#eaeaea" border="0" cellpadding="8" cellspacing="0">        <tbody><tr>          <td background="/images/script_top.gif" height="7"><br></td>        </tr>        <tr>          <td background="/images/script_ground.gif"><p><font color="#009900">-- PIVOT 연산자 사용 </font></p>            <p><b>SELECT * FROM (</b>SELECT T2.회원명, T3.상품명, SUM(수량) 수량합<br>              FROM 주문 T1 <br>              INNER JOIN 회원 T2 ON T1.회원번호 = T2.회원번호<br>              INNER JOIN 상품 T3 ON T1.상품번호 = T3.상품번호<br>              GROUP BY T2.회원명, T3.상품명<b>) T</b><br>              <b>PIVOT (SUM(수량합) FOR 상품명 IN ([자전거], [카메라], [노트북])) AS PVT</b></p></td>        </tr>        <tr>          <td background="/images/script_bottom.gif" height="7"><br></td>        </tr>      </tbody></table>      <p align="left">굵은 글씨체로 되어 있는 부분이 기존의 쿼리문에 추가된 내용입니다. 특히 마지막 줄의 PIVOT 연산자 부분을 관심있게 보시기 바랍니다. <b>FOR 상품명 IN ([자전거], [카메라], [노트북])</b> 이 부분이 결과 값을 컬럼으로 변형 시키는 부분이고  <b>SUM(수량합)</b> 부분이 SUM() 함수를 이용해 새롭게 값을 계산하는 부분입니다. 물론 위 예제에서는 SUM() 함수가 큰 역할을 하지 못하네요. </p>      <p align="left">결과는 다음과 같습니다.</p>      <table class="script" width="580" align="center" bgcolor="#eaeaea" border="0" cellpadding="8" cellspacing="0">        <tbody><tr>          <td background="/images/script_top.gif" height="7"><br></td>        </tr>        <tr>          <td background="/images/script_ground.gif"><pre>회원명               자전거      카메라      노트북<br>-------------------- ----------- ----------- -----------<br>김주몽               NULL        2           2<br>이장래               3           NULL        NULL<br></pre><div style="text-align: left;">홍길동               3           4           NULL<br></div><pre>(3개 행 적용됨)</pre>          </td>        </tr>        <tr>          <td background="/images/script_bottom.gif" height="7"><br></td>        </tr>      </tbody></table>      <p><b><font color="#0000ff"><b><font color="#006600">3. 정리</font></b></font></b></p>      <p align="left">만일 PIVOT 연산자가 없다는 마지막에 얻은 결과를 얻기 위해서 복잡한 쿼리문을 작성해야 합니다. MS SQL Server2005에 새롭게 선보인 향상된 Transact-SQL 구문은 이처럼 쿼리문을 간단하게 할 수 있는 편리함을 제공해주고있습니다. 다음 강좌에서는 PIVOT 연산자와 반대의 기능을 담당하는 UNPIVOT 연산자를 상펴보도록 하겠습니다. </p>    </td>  </tr></tbody></table></p>                                </td>                            </tr>                            <tr>                                <td>                                    <p>&nbsp;</p>                                </td>                            </tr>                        </tbody></table>                    </td>                </tr>                <tr>                    <td>                        <p>&nbsp;</p></td></tr></tbody></table><br></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
