<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[펌] MySQL InnoDB Performance Tuning for the Solaris 10 OS</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2008-07-22 03:27:59</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[펌] MySQL InnoDB Performance Tuning for the Solaris 10 OS</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">From : http://developers.sun.com/solaris/articles/mysql_perf_tune.html<br><br><div class="pagetitle2">Article</div><div id="sharepage" class="smallpagetitle"><h1>MySQL InnoDB Performance Tuning for the Solaris 10 OS</h1><div class="sharepage"><div class="sharepagew1 share-mailto"><table summary="layout" cellpadding="0" cellspacing="0"><tbody><tr><td id="share-mailto"><br></td><td id="share-technorati"><br></td><td id="share-delicious"><br></td><td id="share-digg"><br></td><td id="share-slashdot"><br></td><td id="share-blank"> <br></td></tr></tbody></table></div></div></div><!-- END PAGETITLE --><!-- BEGIN WRAPPER TABLE, 2 COLUMN, MAIN/RIGHT --><!-- BEGIN CENTRAL COLUMN COMPONENTS --><!--startindex--><!-- ============ --><!-- MAIN CONTENT --><!-- ============ --><a name="skip2content"></a><!--  BEGIN VCD4 PFV  --><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td class="smaller" valign="top"><em></em><br></td><td width="10">&nbsp;</td><td align="right" valign="bottom"><div class="sitelinks" style="padding: 0px;"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td align="right" valign="bottom">&nbsp;</td><td class="smaller" valign="bottom" nowrap="nowrap"><a href="http://developers.sun.com/jsp_utils/PrintPage.jsp" target="printFriendlyView" onclick="openPopup('','printFriendlyView',710,650,'no',1,1,0,0,0,0); return true;"><img src="http://developers.sun.com/im/ic_print.gif" alt="Print-friendly Version" border="0" width="14" height="12" hspace="4">Print-friendly Version</a><br></td></tr></tbody></table></div></td></tr></tbody></table><!--  END VCD4 PFV --><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td class="smaller" valign="top"><em>By <a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#14">Luojiia Chen</a>, Updated February 2008</em></td><td width="10">&nbsp;</td><td align="right" valign="bottom"><div class="sitelinks" style="padding: 0px;"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><!--<td valign="bottom" align="right"><img src="/im/ic_email.gif" width="14" height="12" border="0" hspace="4" vspace="1" alt=" " /></td><td valign="bottom" class="smaller" nowrap="nowrap"><a href="#{link placeholder}">E-mail</a></td><td>&nbsp;&nbsp;</td><td valign="bottom" align="right">&nbsp;</td><td valign="bottom" class="smaller" nowrap="nowrap"><a href="/jsp_utils/PrintPage.jsp" target="printFriendlyView" onclick="openPopup('','printFriendlyView',710,650,'no',1,1,0,0,0,0); return true;"><img src="/im/ic_print.gif" width="14" height="12" alt="Print-friendly Version" border="0" hspace="4" />Print-friendly Version</a></td><td>&nbsp;&nbsp;</td><td valign="bottom" align="right"><img src="/im/ic_download_thin.gif" width="9" height="14" hspace="4" border="0" alt=" " /></td><td valign="bottom" class="smaller" nowrap="nowrap"><a href="#{link placeholder}">Download</a></td>--></tr></tbody></table></div><br></td></tr></tbody></table><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><!--  END VCD4 BYLINE AND TOOLS  --><!-- BEGIN VCD01 Overview --><!-- BEGIN VCD1 OVERVIEW COMPONENT  --><div class="padbottom10"><b>Abstract</b>: You can maximize theperformance of MySQL on the Solaris platform through configuration andtuning of the database server, along with optimizing the Solaris OS forMySQL. This paper is intended to help you define tuning parameters andtune them in your environment.</div>      <!-- END VCD1 OVERVIEW COMPONENT  --><!-- END VNV4 LEFTNAV  COMPONENT -->      <div><b>Contents</b></div><span class="sp2">&nbsp;</span><br><table class="vatop" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#0" class="named">Introduction</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#1" class="named">InnoDB User Threads</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#2" class="named">Using the Optimized Time Library to Minimize the <code>time</code>(2) System Call</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#3" class="named">Using the Solaris OS <code>mtmalloc</code> Memory Allocator in MySQL</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#4" class="named">Using 64-bit MySQL on the Solaris Platform</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#5" class="named">Building MySQL With Sun Studio 11 Software</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#6" class="named">Optimizing File System Performance</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#7" class="named">InnoDB Data and Index Cache Size</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#8" class="named">Transaction Log Flushing Mode</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#9" class="named">Log Buffer Size</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#10" class="named">Checkpoint Operation</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#11" class="named">Query Cache Size</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#12" class="named">Conclusion</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#13" class="named">Resources</a></td></tr><tr><td class="hyphen">-&nbsp;</td><td><a href="http://developers.sun.com/solaris/articles/mysql_perf_tune.html#14" class="named">About the Author</a></td></tr></tbody></table><span class="sp20">&nbsp;</span><br><!-- <span class="sp10">&nbsp;</span><br> --><a name="0"><div><b>Introduction</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>MySQL is one of the world's most popular open source databases. A keystrength of the MySQL database is its excellent performance andscalability, making it well suited to serve as a back end for websites, data warehousing, and other data-intensive applications in theenterprise environment. </p><p>To maximize the performance of MySQL on the Solaris OperatingSystem, database server configuration and tuning are important, as wellas theoptimization of the Solaris OS for MySQL. However,no universal MySQL server tuning parameters apply to all workloads onall platforms; the appropriate parameters will depend on yourparticular workload, hardware and OS platform, andMySQL usage. This paper is intended to help you define theseparameters and tune them in your environment. </p><p>MySQL includes several storage engines, including MyISAM, InnoDB,HEAP, and Berkeley DB (BDB). InnoDB and BDB storage support Atomic,Consistent, Isolation, and Durable (ACID) transactions with commit,rollback, and crash recovery capabilities, and only InnoDB storagesupports row-level locks with queries running as non-lockingconsistent reads by default. </p><p>The InnoDB storage engine supports all four isolation levels: readuncommitted,read committed, repeatable read, and serializable. InnoDB also has thefeature known as referential integrity with foreign key constraintssupport, and it supports fast record lookups for queries using aprimary key. Because of these and other powerful functions andfeatures, InnoDB is often used in large, heavy-load productionsystems. This paper covers the different ways to improve the use ofCPU, memory, and disk drive resources for the Solaris 10 OS. Topicsinclude using optimized libraries, compiling 64-bit MySQL with <a href="http://sun.com/sunstudio11">Sun Studio 11 software</a>,tuning the Solaris UFS file system, and MySQL server configuration andtuning for the InnoDB storage engine on the Solaris platform.</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="1"><div><b>InnoDB User Threads</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>MySQL is a single-process, multithreaded application. One master threadhas the highest priority among all the MySQL threads to control theserver. The main thread is idle most of the time and “wakes up”every 300 milliseconds (msec) to check whether an action is required, suchas flushing dirty blocks in the buffer pool. </p><p>In addition to the main threads, a dedicated set of userthreads run at normal priority in the thread pools to handlesimultaneous client requests. For each client request, onesingle thread is created to process the client request and send back theresult to each client once the result is ready. And there is onesingle user thread that waits for input from the console and a groupof utility threads running at lower priority to handle somebackground tasks.</p><p>Right now, MySQL cannot scale well with the number of the user threads handlingclient requests. Performance scales up efficiently with eachadditional user thread until it reaches the peak performance point.After that, increasing the number of user connections will decreaseMySQL performance because of thread concurrency contention. Forapplications where the number of user connections is tunable, youneed to determine -- for different workloads -- the optimumnumber of user connections for peak performance. </p><p>We ran the <a href="http://sysbench.sourceforge.net/">SysBench</a>CPU-bound benchmark test (1M-row data can be filled in the InnoDB dataand indexcache buffer) on a four-way UltraSPARC IV processor-based server. MySQLperformance peaked at 16 user connections, and started to drop from 32user connections, as shown in the following graph. (Please note:Results may vary.)</p><br><span class="sp10">&nbsp;</span><br> <div class="padbottom10"><table align="center" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><img src="http://developers.sun.com/solaris/articles/images/mysql_perftune_fig1.gif" alt="Figure 1: MySQL 5.0.7 SysBench Connection Scalability Test" border="0"></td></tr><tr><td class="grey3"><div class="pad6"><span class="dkcaption1">Figure 1: MySQL 5.0.7 SysBench Connection Scalability Test</span></div></td></tr></tbody></table></div><br><p>This test shows that for the SysBench workload, peak MySQLperformance on the UltraSPARC IV processor-based server can be achievedby setting the number of user connections as 4*CPUs on a 1-4 CPUsystem. The peak MySQL performance scales in a nearly linear fashion upto 4 CPUs, and the scalability ratio starts to drop from 8 CPUs. Thefollowing figure shows the scalability test result using systems with1-24 UltraSPARC IV processors. (Please note: Results may vary.)</p><br><span class="sp10">&nbsp;</span><br> <div class="padbottom10"><table align="center" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><img src="http://developers.sun.com/solaris/articles/images/mysql_perftune_fig2.gif" alt="Figure 2: MySQL 5.0.7 SysBench CPU Scalability Test" border="0"></td></tr><tr><td class="grey3"><div class="pad6"><span class="dkcaption1">Figure 2: MySQL 5.0.7 SysBench CPU Scalability Test</span></div></td></tr></tbody></table></div><br><p>For applications where the number of user connections is not tunable,the <code>innodb_thread_concurrency</code> parameter can be configured to setthe maximum number of threads concurrently kept inside InnoDB. You need to increasethis value when you see many queries in the queue in <code>showinnodb status</code>. In MySQL versions below 5.0.8, set this value over 500can disable the  concurrency checking, so there will be as many threads concurrentlyrunning  inside InnoDB as needed to handle the different tasks inside the server.This  variable changed from MySQL 5.0.8: setting it equal or greater than 20will disable the concurrency checking; and it changed again from MySQL 5.0.19and above: you will need to set <code>innodb_thread_concurrency</code> to be0 to disable the concurrency checking. In some workloads running on the Solarisplatform, when you see a large user level lock (<code>LCK</code> in the <code>prstat –mL</code> output),reducing this parameter increases the efficiency of CPU usage toimprove overall performance. Tuning this parameter according to thebehavior of your system at runtime can affect performancesignificantly.</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="2"><div><b>Using the Optimized Time Library to Minimize the <code>time</code>(2) System Call</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>On the Solaris platform, the <code>time</code>(2) system call actually takes a trap to the kernelto call <code>gethrestime</code>(), which is expensive and time consuming. WhenMySQL executes each query, it performs a <code>time</code>(2) system call at thestart and at the end to measure how long the query takes. For someworkloads, MySQL can spend more than 30 percent of system time on the<code>time</code>(2) system call, consuming a large amount of system CPU cycles asillustrated below:</p><!-- BEGIN VCD7 CODE SAMPLE COMPONENT  --><table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%"><tbody><tr><td><pre># truss -c -p 385<br>syscall                seconds    calls     errors<br>read                   28.286     450958     3248<br>write                  19.516     231648<br>open                     .000          2<br>close                    .000          2<br>time                   45.247     848307<br>lseek                    .329       6878     6800<br>alarm                    .140       2218<br>fdsync                  1.140       5520<br>fcntl                    .364       6510<br>lwp_park               12.288     187383<br>lwp_unpark             11.134     187381<br>poll                    4.535      67263<br>sigprocmask             2.072      36030<br>sigtimedwait             .381       2506<br>yield                    .741       9829<br>lwp_kill                 .201       2512<br>pread                    .000          2<br>pwrite                  1.040       5527<br>                     --------     ------     ----<br>sys totals:           127.447    2051007    10048<br>usr time:             101.288<br>elapsed:              123.750<br></pre></td></tr></tbody></table><span class="sp20"> </span><br><!-- END VCD7 CODE SAMPLE COMPONENT  --><p>On the Solaris platform, we can optimize the <code>time</code>(2) system call by implementing the faster <code>gethrtime</code>(3C) system call instead of calling <code>gethrestime</code>() in the kernel. If your workload is spending lots of system CPU resources on the <code>time</code>(2) system call (you can verify this by checking the <code>truss</code> output), it may make sense to re-compile the MySQL DB by linking it to the optimized time library described in <a href="http://developers.sun.com/solaris/articles/time_stamp.html">A Performance Optimization for C/C++ Systems That Employ Time-Stamping</a>. Do this by adding <code>LIBS='-lfasttime'</code> at the beginning of the <code>configure</code> file under the MySQL source tree home to implement <code>gethrtime</code>(3C), or you can set <code>LD_PRELOAD</code> (32-bit) or <code>LD_PRELOAD_64</code> (64-bit) to point to the location of the <code>libfasttime.so</code> library. We ran the <a href="http://www.osdl.org/lab_activities/kernel_testing/osdl_database_test_suite/osdl_dbt-2/">OSDL Database Test 2 (DBT2)</a> workload test and improved the MySQL performance by about 7 percent by using the optimized <code>time</code>(2) in the 10-warehouse workload test on an 8-way UltraSPARC system.</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="3"><div><b>Using the Solaris OS <code>mtmalloc</code> Memory Allocator in MySQL</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>The <code>malloc</code> routine on the Solaris platform behaves rather well from a memory footprintperspective; however, the default single-thread <code>malloc</code> in <code>libc</code> handles the concurrent memory allocation requests one by one in aqueue, slowing down performance in multithreaded applications. The Solaris OS offers several <code>malloc</code> implementations, including <code>mtmalloc</code>, <code>libumem</code>, and <code>hoard</code> to improve memory allocation performance for multithreaded applications. However, it can be difficult to tell which <code>malloc</code> implementation is best for different applications as that depends on the memory allocation pattern of the application andhow the different algorithms in the different <code>malloc</code> implementationsfit the memory allocation pattern of the application.   </p><p>MySQL actively uses <code>malloc</code>() and <code>free</code>() to allocate memory for unexpectedly large strings. The <code>malloc</code> calls block <code>mysqld</code> threads for HEAP contention. By measuring with different memory allocators, replacing <code>malloc</code> with <code>mtmalloc</code>can significantly improve MySQL DB performance. We saw about a 65percent improvement in the SysBench CPU-bound benchmark test (1M-rowdata can be filled in the InnoDB data and index cache buffer). We ranthis test on an 8-way dual-core UltraSPARC IV processor-based systemwith MySQL 5.0.7. </p><p>To use <code>mtmalloc</code>, you can preload the <code>mtmalloc</code> library by setting the <code>LD_PRELOAD</code> or <code>LD_PRELOAD_64</code>environment variable in the MySQL startup script on the Solarisplatform, so that you do not have to rebuild the MySQL DB to link tothe <code>mtmalloc</code> library.</p><p>If it is 32-bit MySQL, preload <code>mtmalloc</code> by setting <code>LD_PRELOAD</code> as follows:</p><!-- BEGIN VCD7 CODE SAMPLE COMPONENT  --><table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%"><tbody><tr><td><pre>LD_PRELOAD=/usr/lib/libmtmalloc.so (x86)<br>LD_PRELOAD=/usr/lib/libmtmalloc.so(sparc)<br></pre></td></tr></tbody></table><span class="sp20"> </span><br><!-- END VCD7 CODE SAMPLE COMPONENT  --><p>If it is 64-bit MySQL, set <code>LD_PRELOAD_64</code> as follows:</p><!-- BEGIN VCD7 CODE SAMPLE COMPONENT  --><table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%"><tbody><tr><td><pre>LD_PRELOAD_64=/usr/lib/amd64/libmtmalloc.so(x64)<br>LD_PRELOAD_64=/usr/lib/sparcv9/libmtmalloc.so(64-bit sparc)<br></pre></td></tr></tbody></table><span class="sp20"> </span><br><!-- END VCD7 CODE SAMPLE COMPONENT  --><p>MySQL 5.0 GA binary for Solaris OS released by MySQL has been built to use <code>libmtmalloc</code> with <code>"--with-mysqld-libs=-lmtmalloc"</code> configuration flag, so you will not need to set the <code>LD_PRELOAD</code> or <code>LD_PRELOAD_64</code> environment variable to use <code>mtmalloc</code>.</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="4"><div><b>Using 64-bit MySQL on the Solaris Platform</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>TheSolaris OS is a full 64-bit computing environment providing binarycompatibility with 32-bit applications, so that both 64-bit and32-bit MySQL can run well on the Solaris platform. Compared to 32-bit MySQL, 64-bit MySQL can address more memory for the data cache, code cache, and metadata caches inside MySQL to reduce disk I/O. Inaddition, with wider CPU operations in the 64-bit computingenvironment, 64-bit MySQL operates faster than 32-bit MySQL. The following figure depicts the performance data in the <a href="http://sysbench.sourceforge.net/">SysBench</a>CPU-bound test (1M-row data can be filled in the InnoDB data and indexcache buffer) on an 8-way UltraSPARC IV based server. (Note: Resultsmay vary.)</p><br><span class="sp10">&nbsp;</span><br> <div class="padbottom10"><table align="center" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><img src="http://developers.sun.com/solaris/articles/images/mysql_perftune_fig3.gif" alt="Figure 3: MySQL 4.1.11 CPU-Bound SysBench Test" border="0"></td></tr><tr><td class="grey3"><div class="pad6"><span class="dkcaption1">Figure 3: MySQL 4.1.11 CPU-Bound SysBench Test</span></div></td></tr></tbody></table></div><!-- <span class="sp10">&nbsp;</span><br> --><a name="5"><div><b>Building MySQL With Sun Studio 11 Software</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>To build 64-bit MySQL on the Solaris platform using the Sun Studio11 release, use the compiler flags and configuration options as shownhere:</p><p>With the Solaris OS for x64 platforms:</p><!-- BEGIN VCD7 CODE SAMPLE COMPONENT  --><table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%"><tbody><tr><td><pre>CC=cc CFLAGS="-xO4 -mt -fsimple=1 -ftrap=%none -nofstore<br>-xbuiltin=%all -xlibmil -xlibmopt -xtarget=opteron <br>-xarch=amd64 -xregs=no%frameptr"<br>CXX=CC CXXFLAGS="-xO3 -mt -fsimple=1 -ftrap=%none -nofstore<br>-xbuiltin=%all -xlibmil -xlibmopt -xtarget=opteron <br>-xarch=amd64 -xregs=no%frameptr"<br>LDFLAGS="-xtarget=opteron -xarch=amd64"<br>./configure --prefix=/usr/local/mysql <br>--localstatedir=/usr/local/mysql/data <br>--libexecdir=/usr/local/mysql/bin --with-extra-charsets=complex <br>--with-server-suffix=-standard --enable-thread-safe-client <br>--enable-local-infile --with-named-curses=-lcurses <br>--with-big-tables --disable-shared --with-readline <br>--with-archive-storage-engine --with-innodb<br></pre></td></tr></tbody></table><span class="sp20"> </span><br><!-- END VCD7 CODE SAMPLE COMPONENT  --><p>With the Solaris OS for SPARC platforms:</p><!-- BEGIN VCD7 CODE SAMPLE COMPONENT  --><table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%"><tbody><tr><td><pre>CC=cc CFLAGS="-xO4 -mt -fsimple=1 -ftrap=%none<br>-xbuiltin=%all -xlibmil -xlibmopt -xstrconst -xarch=v9"<br>CXX=CC CXXFLAGS="-xO3 -noex -mt -fsimple=1<br>-ftrap=%none -xbuiltin=%all -xlibmil -xlibmopt<br>-xarch=v9"<br>./configure --prefix=/usr/local/mysql<br>--localstatedir=/usr/local/mysql/data <br>--libexecdir=/usr/local/mysql/bin <br>--with-extra-charsets=complex <br>--with-server-suffix=-standard <br>--enable-thread-safe-client --enable-local-infile <br>--with-named-z-libs=no --with-big-tables <br>--disable-shared --with-readline <br>--with-archive-storage-engine --with-innodb<br></pre></td></tr></tbody></table><span class="sp20"> </span><br><!-- END VCD7 CODE SAMPLE COMPONENT  --><p>To compare the performance of the MySQL database built withdifferent compiler releases (Sun Studio 10 and Sun Studio 11), we usedthe <a href="http://www.osdl.org/lab_activities/kernel_testing/osdl_database_test_suite/osdl_dbt-2/">DBT2</a>test suite. The workload represents a wholesale parts supplieroperating out of a number of warehouses and associated salesdistricts. The tasks involve the mixture of read-only andupdate-intensive transactions to enter and deliver orders, recordpayments, check the status of the orders, and monitor the level ofstock at the warehouses. The nine tables include Warehouse,District, Item, Stock, Customer, Order, New order, Order-line andHistory, scaling with the number of warehouses (except the Item table). </p><p>We ran the DBT2 test using the 10-warehouse database on the Solaris 10OS on four dual-core 2200-MHz AMD Opteron processor-based Sun Fire x64servers. In this test case, most database queries were cached in the <code>innodb</code>buffer. Most of the CPU time was spent on processing the queries, sothe system was CPU bound during this test. The test metric was thethroughput, that is, new-order transactions perminutes. As shown in our test result data in the following figure,MySQL built with Sun Studio 11 performed around 13 percent better thanMySQL built with SunStudio 10 software. (Note: Results may vary.)</p><br><span class="sp10">&nbsp;</span><br> <div class="padbottom10"><table align="center" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><img src="http://developers.sun.com/solaris/articles/images/mysql_perftune_fig4.gif" alt="Figure 4: MySQL 5.0.15 DBT2 on Solaris 10 OS" border="0"></td></tr><tr><td class="grey3"><div class="pad6"><span class="dkcaption1">Figure 4: MySQL 5.0.15 DBT2 on Solaris 10 OS</span></div></td></tr></tbody></table></div><br><p>In addition to the optimized performance improvement for the MySQLdatabase that Sun Studio 11 offers compared to Sun Studio 10 in the x64architecture-based system, Sun Studio 11 also provides the multicoreandchip multithreading (CMT) optimizations in the UltraSPARCprocessor-based system. The Sun Studio 11 release also includes anadvanced graphical debugger tool to easily set breakpoints, examinevariables, navigate the call stack, and debug the multithreaded codeinside MySQL. Thesophisticated performance analysis tool in Sun Studio 11 softwareprovidesadditional data space profiling ability on the UltraSPARCprocessor-based system toevaluate the performance costs associated with the applicationmemory references. The detailed instructions on how to use these newfeatures in the debugger and performance analyzer tools in Sun Studio11software can be found in the comprehensive <a href="http://docs.sun.com/app/docs/coll/771.7">user guide</a>.</p><p>Sun Studio 11 software also bundles the <code>dmake</code> tool,which can compile MySQLsource code in parallel. <code>dmake</code> can significantlyimprove compilationperformance compared to <code>make</code> on a multiprocessorsystem. On an 8-core Sun Fire T2000 system with T1 processors, it took only 9minutes to compile MySQL source code using <code>dmake -j 64</code>-- this was over 3 times faster than using <code>make</code>, whichtook 29 minutes.</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="6"><div><b>Optimizing File System Performance</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>File system cluster size can have a big impact on system performance-- particularly when MySQL is running a workload with a database sizemuch bigger than system memory. On the Solaris platform, UFS filesystem cluster size (the <code>maxcontig</code> parameter) is set as128 by default. The file system block size on the Solaris 10 OS forSPARC platforms (x86/x64) is 8 Kbytes. You can get the value of <code>maxcontig</code> and <code>bsize</code> using the <code>mkfs –F</code> or <code>fstyp –v </code>command on the file system. This will trigger read-ahead for the wholefile system cluster length (128*8 Kbytes), even in random I/O, whichcan saturate a disk and significantly degrade performance.</p><p>One way to solve this problem is to reduce the value of the <code>maxcontig</code> parameter so that the disk I/O transfer size matches the DB block size. You can change the <code>maxcontig</code> value by using the <code>tunefs –a</code><code> maxcontig#</code> command on the file system. The shortcoming of thissolution is that it may impact the performance of other workloadsrunning large sequential I/O from the client. </p><p>Another solution is to enable file system Direct I/O by mounting thefile system with the option <code>--forcedirectio</code>, since file system DirectI/O will automatically disable the read-ahead. In addition, sinceMySQL has its own data and cache buffers, using Direct I/O candisable the file system buffer to save the CPU cycles from being spent ondouble buffering. The following figure shows performance data on a Sun Fire V65x server using the <a href="http://sysbench.sourceforge.net/">SysBench</a>I/O bound test (100M-row data cannot fit in the InnoDB data andindex cache buffer). This test compared the performance using default <code>maxcontig</code>, setting <code>maxcontig</code> as 5 (the disk transfer rate size is 5*4 Kbytes), and using Direct I/O. (Note: Results may vary.)</p><br><span class="sp10">&nbsp;</span><br> <div class="padbottom10"><table align="center" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><img src="http://developers.sun.com/solaris/articles/images/mysql_perftune_fig5.gif" alt="Figure 5: MySQL 4.1.11 I/O-Bound SysBench Test" border="0"></td></tr><tr><td class="grey3"><div class="pad6"><span class="dkcaption1">Figure 5: MySQL 4.1.11 I/O-Bound SysBench Test</span></div></td></tr></tbody></table></div><!-- <span class="sp10">&nbsp;</span><br> --><a name="7"><div><b>InnoDB Data and Index Cache Size</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>MySQL doesn't access the disk directly; instead, it reads datainto the internal buffer cache, reads/writes blocks, and flushes thechanges back to the disk. If the server requests data available inthe cache, the data can be processed right away. Otherwise, theoperating system will request that the data be loaded from the disk. The biggerthe cache size, the more disk accesses can be avoided. The defaultvalue of 8 Mbytes is too small for most workloads. You will need toincrease this number when you see that <code>%b</code> (percentage utilization of the disk) is above 60 percent, <code>svc_t</code> (response time) is above 35 msec in the <code>iostat –xnt 5</code> trace output, and a high amount ofread appears in the <code>FILE IO</code> part of the <code>show innodb status</code>output. </p><p>However, you should not set the value of the <code>innodb_buffer_pool_size</code> parameter too high to avoid the expensive paging for the other processes running without enough RAM,because it will significantly degrade performance. For systemsrunning on a single dedicated MySQL process, it should be fine to setthe <code>innodb_buffer_pool_size</code>parameter up to a value between 70 and 80 percent of memory since thefootprint of the MySQL process is only around 2 to 3 Mbytes.</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="8"><div><b>Transaction Log Flushing Mode</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>InnoDB flushes the transaction log to disk approximately once per second inthe background. As a default, the log flushes to the disk on eachtransaction commit. The safest way to avoid transaction loss in theevent of MySQL, OS, or hardware crashes is to use the mode<code>innodb_flush_log_at_trx_commit = 1</code>. </p><p>For workloads running with many short transactions, you can reduce diskwriting by setting the <code>innodb_flush_log_at_trx_commit</code> parameter with differentvalues.</p><p>When setting this value at 0, there is no log flushing on each transactioncommit. It can reduce the disk I/O to improve performance, however,the transaction might be lost if MySQL crashes.</p><p>When setting this value at 2, the log flushes to the OS cache (file systemcache) instead of the disk on each transaction commit. It can alsoreduce the disk I/O and perform a little slower than when the valueis set at 0; however, no transaction loss occurs in the eventthat MySQL crashes (although a loss will probably occur if the OS orhardware crashes).</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="9"><div><b>Log Buffer Size</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><div>For large transactions, before the log buffer is flushed on each transactioncommit, if your setting <code>innodb_flush_log_at_trx_commit</code> is at 1, thelog can be loaded into the log buffer instead of flushing to the diskin the background to reduce the disk I/O. If you see large log I/Oin the <code>show innodb status</code> output at runtime, youprobably need to set a larger value for the <code>innodb_log_buffer_size</code>  parameter. For most workloads without long transactions, it is not necessary towaste memory resources by setting a higher value for the log buffer.It is usually fine to set it between 8 and 64 Mbytes. </div><span class="sp10">&nbsp;</span><br> <!-- <span class="sp10">&nbsp;</span><br> --><a name="10"><div><b>Checkpoint Operation</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>The recovery management subsystem inside InnoDB flushes database pagesand transaction operations to the log files for the purpose of backupand recovery. It implements a fuzzy checkpoint operation bycontinually flushing modified database pages from the buffer pool insmall batches. InnoDB writes to the log files in a circular fashion,so if the log file has reached the configure limit set by the<code>innodb_log_file_size</code> parameter, the checkpoint operation is executed at once toflush the modified database pages. This is done in order to make sure the committedmodification pages are available in the log files in case ofrecovery.</p><p>The size of each log file should be chosen to avoid executing checkpointoperations too often. The bigger log file size reduces disk I/O incheckpointing. You will need to increase this parameter when you seelarge page writes in the <code>BUFFER POOL AND MEMORY</code> part of the <code>showinnodb status</code> output. However, the larger size of the log fileincreases the “redo” recovery time in case of a servercrash.</p><!-- <span class="sp10">&nbsp;</span><br> --><a name="11"><div><b>Query Cache Size</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><p>In addition to the data and index buffer cache, MySQL version 4.0.1 andlater has a nice feature called query cache that stores the identicalSELECT queries issued by clients to the database server. This makesit possible to locate and re-issue the same queries withoutrepetitive hard parsing activities. MySQL alsostores the query's result set in the query cache, which cansignificantly reduce the overhead of creating complex result sets forqueries from the disk or memory caches, reducing both physical andlogical I/O. For some applications executing the same queries fromuser clients, the query cache can greatly improve the response time.</p><p>The <code>query_cache_size</code> parameter is used to allocate an amount ofmemory to cache the frequently executed queries and return the resultset back to the client without real query execution. The <code>query_cache_type</code> parameter is used to enable or disable query cache indifferent ways. To decide how to set these two parameters, you needto check the <code>qcache_inserts</code>, <code>qcache_hits</code>, and <code>qcache_free_memory</code>during runtime. <code>qcache_inserts</code> shows the number of queries added tothe query cache, <code>qcache_hits</code> shows the number of query results takenfrom the query cache without real query execution, and<code>qcache_free_memory</code> shows the free available memory for query cachenot being used. </p><p>If you see a high value for <code>qcache_hits</code> compared to your total queries at runtime or a low value for <code>qcache_free_memory</code>, you probably need to increase the value of the <code>query_cache_size</code> parameter accordingly. Otherwise, you would decrease the value of the <code>query_cache_size</code>  parameter to save memory resources for the other MySQL cachebuffers. If <code>qcache_hit</code> is 0 in the runtime, you wouldcompletely turn off the query cache by setting <code>query_cache_type</code> as 0,together with setting <code>query_cache_size</code> as 0.</p><p>The <code>query_cache_limit</code> parameter sets the maximum result sets stored in the query cache. A low ratio of <code>qcache_hits</code> to <code>qcache_insert</code> at runtime may also be caused by too low a setting for the <code>query_cache_limit</code> parameter. In this case, you will need to increase the value of the <code>query_cache_limit</code> parameter to store the large query result sets in the query cache. </p><!-- <span class="sp10">&nbsp;</span><br> --><a name="12"><div><b>Conclusion</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><div>The outstanding performance and scalability of MySQL can be enhanced evenfurther by tuning the storage engines within MySQL for specificworkloads running on Sun systems. While there are many variables thatimpact performance and many parameters for tuning for each workload,this paper has attempted to provide general guidelines and practicaladvice to help you optimize the performance of InnoDB on the Solarisplatform. We welcome your feedback on this paper and your insightsinto achieving higher performance for MySQL on Sun systems. </div><span class="sp10">&nbsp;</span><br> <!-- <span class="sp10">&nbsp;</span><br> --><a name="13"><div><b>Resources</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><ul><li><a href="http://dev.mysql.com/doc/mysql/en/">MySQL Reference Manual</a></li><li><a href="http://www.sun.com/books/catalog/packer.xml">Configuring &amp; Tuning Databases on the Solaris Platform</a></li><li><a href="http://developers.sun.com/solaris/articles/time_stamp.html">APerformance Optimization for C/C++ Systems that Employ Time-Stamping</a></li><li><a href="http://developers.sun.com/solaris/articles/multiproc/multiproc.html">A Comparison of Memory Allocators in Multiprocessors</a></li><li><a href="http://developers.sun.com/sunstudio/download">Sun Studio 11 Software Download</a> (Optimizing C, C++, and Fortran compilers and tools)</li></ul><!-- <span class="sp10">&nbsp;</span><br> --><a name="14"><div><b>About the Author</b></div></a><div class="contentdivider"><table class="grey4" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img src="http://developers.sun.com/im/a.gif" alt=" " border="0" width="1" height="4"></td></tr></tbody></table></div><div>Luojia Chen is a software engineer in Sun's Market DevelopmentEngineeringorganization, in the open source team. She is currently responsible forMySQL adoption and migration for Sun's latest technologies, and she isfocused on making MySQL run and scale well on the Solaris platform. Shecan bereached at <a href="mailto:luojia.chen@sun.com">luojia.chen@sun.com</a>.</div><br></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
