<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[펌] Oracle Performance Tuning SQL Scripts</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2007-06-19 04:44:43</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[펌] Oracle Performance Tuning SQL Scripts</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content"><p>From : <a href="http://database.sarang.net/?inc=read&amp;aid=8913&amp;criteria=oracle&amp;subcrit=&amp;id=112&amp;limit=20&amp;keyword=v%24statement&amp;page=29">http://database.sarang.net/?inc=read&amp;aid=8913&amp;criteria=oracle&amp;subcrit=&amp;id=112&amp;limit=20&amp;keyword=v%24statement&amp;page=29</a><br><br><table class="infotable" style="TEXT-ALIGN: left" cellspacing="0" cellpadding="3" border="0"><tbody><tr><td class="rowtitle" colspan="6">Oracle Performance Tuning SQL Scripts</td></tr><tr><th class="infotable_th"><div style="WHITE-SPACE: nowrap">작성자</div></th><td class="rowmisc"><div style="WHITE-SPACE: nowrap">정재익(advance)</div></td><th class="infotable_th"><div style="WHITE-SPACE: nowrap">작성일</div></th><td class="rowmisc"><div style="WHITE-SPACE: nowrap">2001-12-14 22:17:17</div></td><th class="infotable_th"><div style="WHITE-SPACE: nowrap">조회수</div></th><td class="rowmisc" align="right"><div style="WHITE-SPACE: nowrap">2,903</div></td></tr></tbody></table><table class="viewtable" style="TEXT-ALIGN: left"><tbody><tr><td class="rowbody"><p>원본 출처 : http://bora.dacom.co.kr/~mhan/oracle/tun/sql/index.html</p><p>&nbsp;</p></td></tr></tbody></table></p><p>[b][color=005511]SESS.SQL ...&nbsp; Session 상황 조회 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;SESS.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; List of current active session status<br>#<br>TTITLE OFF<br>CLEAR COLUMN<br>SET PAGESIZE 60<br>SET LINESIZE 130<br>COLUMN SID &nbsp;FORMAT 9999<br>COLUMN USERNAME FORMAT A12<br>COLUMN COMMAND&nbsp; FORMAT A20<br>SELECT PROCESS PID,SE.SID,SERIAL#,STATUS,USERNAME,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DECODE(COMMAND, 0,' ',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- Normal<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1,'CREATE TABLE',&nbsp;&nbsp; 2,'INSERT',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3,'SELECT',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5,'ALTER CLUSTER',&nbsp;&nbsp; 6,'UPDATE',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7,'DELETE',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9,'CREATE INDEX',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 45,'ROLLBACK',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 47,'PL/SQL EXECUTE',<br>&nbsp;&nbsp;&nbsp; COMMAND) COMMAND,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TERMINAL<br>&nbsp; FROM V$SESSION SE,V$SESS_IO IO<br>&nbsp;WHERE STATUS != 'INACTIVE'<br>&nbsp;&nbsp; AND USERNAME != ' ' <br>&nbsp;&nbsp; AND SE.SID = IO.SID<br>&nbsp;ORDER BY STATUS;</p><p>[b][color=005511]HIT_INS.SQL ...&nbsp; Instance의 hit ratio 조회 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;HIT_INS.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Hit Ratio of Instance<br>&nbsp;&nbsp; 100%에 가까울수록 바람직<br>#&nbsp; <br>TTITLE 'The Hit Ratio'<br>SELECT SUM(DECODE(NAME,'consistent gets',VALUE,0)) "CONSIS GETS",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM(DECODE(NAME,'db block gets',VALUE,0)) "DB BLK GETS",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM(DECODE(NAME,'physical reads',VALUE,0)) "PHYS READS",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SUM(DECODE(NAME,'consistent gets',VALUE,0)) +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM(DECODE(NAME,'db block gets',VALUE,0))&nbsp;&nbsp; -<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM(DECODE(NAME,'physical reads',VALUE,0)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SUM(DECODE(NAME,'consistent gets',VALUE,0)) +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM(DECODE(NAME,'db block gets',VALUE,0)) )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 100 "HIT RATIO"<br>&nbsp; FROM V$SYSSTAT;</p><p>[b][color=005511]LIB_HIT.SQL ...&nbsp; Library hit ratio 조회 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;LIB_HIT.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Hit Ratio of Library<br>&nbsp;&nbsp; 100%에 가까울수록 바람직<br>#&nbsp; <br>TTITLE 'The Library Hit Ratio'<br>select round(sum(pinhits)/sum(pins) * 100,2) <br>&nbsp; from v$librarycache;</p><p>[b][color=005511]SHAREDPOOL.SQL ...&nbsp; Shared pool의 free buffer 조회 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;SHAREDPOOL.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Percentage of free space in the SGA shared pool area<br>&nbsp;&nbsp; This percentage should not drop below 5%<br>#&nbsp; <br>TTITLE 'Percentage of free space in the SGA shared pool area'<br>select round((sum(decode(name, 'free memory', bytes, 0)) / <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum(bytes)) * 100,2)<br>&nbsp; from v$sgastat;</p><p>[b][color=005511]TS_STATUS.SQL ...&nbsp; Tablespace list와 그 storage 정의 내용 조회 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;TS_STATUS.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; List of all defined tablespaces<br>#&nbsp; <br>SELECT tablespace_name "TABLESPACE",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; initial_extent "INITIAL_EXT",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; next_extent "NEXT_EXT",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; min_extents "MIN_EXT",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; max_extents "MAX_EXT",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pct_increase<br>&nbsp; FROM dba_tablespaces;</p><p>[b]출력 [/b]</p><p>TABLESPACE INITIAL_EXT NEXT_EXT MIN_EXT MAX_EXT PCT_INCREASE<br>----------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ----------- --------&nbsp;&nbsp;&nbsp;&nbsp; -------&nbsp;&nbsp;&nbsp; -------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ------------<br>SYSTEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10240000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10240000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 50<br>USERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10240000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10240000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 50</p><p>[b][color=005511]TS_DF.SQL ...&nbsp; Tablespace가 어떤 크기의 datafile로 구성되어 있는가? [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;TS_DF.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; List all data files on a tablespace<br>#<br>SET VERIFY OFF<br>SET PAGESIZE 0<br>COMPUTE SUM of MB&nbsp;&nbsp; <br>select TABLESPACE_NAME,FILE_NAME,BYTES/1024/1024 MB <br>&nbsp; from DBA_DATA_FILES <br>&nbsp;where TABLESPACE_NAME = '&amp;TABLESPACENAME' <br>&nbsp;order by FILE_NAME;</p><p>&nbsp;<br>[b]출력 [/b]</p><p>TABLESPACE_NAME FILE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MB&nbsp;&nbsp;&nbsp;&nbsp; <br>---------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ---------- <br>TS01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filename1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10&nbsp;&nbsp; <br>TS01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filename2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8<br>TS01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filename3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ----<br>sum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 28</p><p>[b][color=005511]TS_FREE.SQL ...&nbsp; Tablespace의 freespace는 얼마나 남아 있는가? [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;TS_FREE.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Freespace information of all tablespaces<br>#<br>SELECT TABLESPACE_NAME, BYTES<br>&nbsp; FROM DBA_FREE_SPACE<br>&nbsp;ORDER BY TABLESPACE_NAME, BYTES DESC;</p><p>[b][color=005511]BLOCK_ROWS.SQL ...&nbsp; Object의 block당 row수 조회 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;BLOCK_ROWS.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; The number of rows per block<br>#&nbsp; <br>SELECT substr(t.rowid,1,8) || '-' || substr(t.rowid,15,4) BLOCK,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count(*) ROW_NUM<br>&nbsp; FROM &amp;table_name t<br>&nbsp;WHERE rownum &lt; 2000<br>&nbsp;GROUP BY substr(t,rowid,1,8) || '-' || substr(t.rowid,15,4)<br>/</p><p>[b][color=005511]DFIO.SQL ...&nbsp; Datafile별 I/O count는 얼마나 발생하고 있는가? [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;DFIO.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Display the Datafile I/O rate for the specified tablespace.<br>#&nbsp; <br>SET PAGESIZE 60<br>SELECT FILE_NAME,PHYRDS,PHYWRTS,PHYRDS+PHYWRTS<br>&nbsp; FROM V$FILESTAT FS,DBA_DATA_FILES DF<br>&nbsp;WHERE DF.TABLESPACE_NAME = '&amp;TABLESPACE'<br>&nbsp;&nbsp; AND FS.FILE# = DF.FILE_ID;</p><p>[b][color=005511]OBJ_FRAG.SQL ...&nbsp; Extent가 많이 발생한 object list [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;OBJ_FRAG.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Information what is the objects which is occured extents many times<br>#<br>SET LINESIZE 130<br>SET PAGESIZE 80<br>COLUMN OWNER&nbsp;&nbsp;FORMAT A16<br>COLUMN SEGMENT_NAME&nbsp;FORMAT A30<br>COLUMN TYPE&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;FORMAT A8<br>COLUMN EXTENTS&nbsp;&nbsp;FORMAT 999<br>COLUMN TS_NAME&nbsp;&nbsp;FORMAT A10<br>COLUMN MAX_EXTENTS&nbsp;HEADING 'MAX|EXTENTS'&nbsp;&nbsp;FORMAT 999<br>COLUMN INI_EXT&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;HEADING 'INITIAL|EXTENT(KB)'&nbsp;FORMAT 99,999,999<br>COLUMN NXT_EXT&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;HEADING 'NEXT|EXTENT(KB)'&nbsp;FORMAT 99,999,999<br>COLUMN PCT_INCREASE&nbsp;HEADING 'PCT|INCR' &nbsp;&nbsp;FORMAT 999<br>SELECT OWNER,SEGMENT_NAME,SEGMENT_TYPE TYPE,EXTENTS,MAX_EXTENTS,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BLOCKS,INITIAL_EXTENT/1024 INI_EXT,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NEXT_EXTENT/1024 NXT_EXT,PCT_INCREASE,TABLESPACE_NAME TS_NAME<br>&nbsp; FROM DBA_SEGMENTS<br>&nbsp;WHERE EXTENTS &gt; &amp;EXTENTS<br>&nbsp;ORDER BY EXTENTS DESC;</p><p>[b][color=005511]OBJ_ACCESS.SQL ...&nbsp; Object별 access하고 있는 session 수 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;OBJ_ACCESS.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; The number of sessions that is using a object<br>#<br>SET PAGESIZE 80<br>SET LINESIZE 130<br>CLEAR COLUMN<br>COLUMN OBJNAME FORMAT A40 HEADING "OBJECT NAME"<br>COLUMN ACNUM&nbsp;&nbsp; FORMAT 999 HEADING "No of Users"<br>SELECT A.OWNER||'.'||OBJECT OBJNAME, COUNT(SID) ACNUM,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INI_TRANS,MAX_TRANS,FREELISTS,PCT_FREE<br>&nbsp; FROM V$ACCESS A, DBA_TABLES T<br>&nbsp;WHERE OB_TYP = 2 /* table */<br>&nbsp;&nbsp; AND A.OWNER = T.OWNER<br>&nbsp;&nbsp; AND A.OBJECT = T.TABLE_NAME<br>&nbsp;GROUP BY A.OWNER,OBJECT,INI_TRANS,MAX_TRANS,FREELISTS,PCT_FREE<br>&nbsp;HAVING COUNT(SID) &gt; 1<br>&nbsp;ORDER BY COUNT(SID) DESC<br>/</p><p>[b][color=005511]IND_5.SQL ...&nbsp; Index를 5개 이상 가진 table list [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;IND_5.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Tables that has indexes more than 5<br>#<br>COLUMN TABLE_NAME FORMAT A30<br>SELECT TABLE_OWNER,TABLE_NAME,COUNT(*) <br>&nbsp; FROM DBA_INDEXES<br>&nbsp;GROUP BY TABLE_OWNER,TABLE_NAME<br>HAVING COUNT(*) &gt; 5 or COUNT(*) = 0<br>&nbsp;ORDER BY TABLE_OWNER,TABLE_NAME;</p><p>[b][color=005511]IND_0.SQL ...&nbsp; Index가 전혀 없는 table들 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name :&nbsp;IND_0.sql<br>&nbsp;&nbsp; Author:&nbsp; &nbsp;Mahnho Han<br>&nbsp;&nbsp; List all tables that do not have any indexes <br>#<br>TTITLE 'Report on all tables without indexes'<br>select&nbsp; owner,table_name<br>&nbsp; from&nbsp; dba_tables<br>MINUS<br>select&nbsp; owner,table_name<br>&nbsp; from&nbsp; dba_indexes;</p><p>[b][color=005511]ROLL_STAT.SQL ...&nbsp; Rollback segment 가 충분한가? [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;ROLL_STAT.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; If the value is &gt; 1%, add more rollback segment<br>#&nbsp; <br>select n.name,round(100*s.waits/s.gets) "%Cont"<br>&nbsp; from v$rollname n,v$rollstat s<br>&nbsp;where n.usn = s.usn;</p><p>[b][color=005511]LOC_HLD.SQL ...&nbsp; 어떤 object에 어떤 lock이 진행중인가? [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name :&nbsp;LOC_HLD.sql<br>&nbsp;&nbsp; Author:&nbsp; &nbsp;Mahnho Han<br>&nbsp;&nbsp; List the objects whis is currently locked <br>#<br>set linesize 130<br>select distinct o.object_name, sh.username||'('||sh.sid||')' "Holder",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sw.username||'('||sw.sid||')' "Waiter",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decode(lh.lmode,1,'null',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2,'row share',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3,'row exclusive',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4,'share',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5,'share row exclusive',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6,'exclusive') "Lock Type"<br>&nbsp; from all_objects o, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; v$session sw,&nbsp; v$lock lw,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; v$session sh,&nbsp; v$lock lh<br>&nbsp;where lh.id1 = o.object_id<br>&nbsp;&nbsp; and lh.id1 = lw.id1<br>&nbsp;&nbsp; and sh.sid = lh.sid<br>&nbsp;&nbsp; and sw.sid = lw.sid<br>&nbsp;&nbsp; and sh.lockwait is null<br>&nbsp;&nbsp; and sw.lockwait is not null<br>&nbsp;&nbsp; and lh.type = 'TM'<br>&nbsp;&nbsp; and lw.type = 'TM';</p><p>[b][color=005511]SQL_ACT.SQL ...&nbsp; 현재 running중인 SQL 조회 [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;SQL_ACT.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Get the SQL that is running this point<br>#<br>SPOOL SQL_ACT<br>SET PAGESIZE 60<br>SET LINESIZE 80<br>SET HEADING OFF<br>COLUMN PROCESS&nbsp;&nbsp; NEW_VALUE PIDVAR NOPRINT<br>COLUMN SID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NEW_VALUE SIDVAR NOPRINT<br>COLUMN DISK_READ NEW_VALUE DSKVAR NOPRINT<br>COLUMN SVRNAME&nbsp;&nbsp; NEW_VALUE SVRVAR NOPRINT<br>TTITLE LEFT 'PID: ' PIDVAR COL20 'SID: ' SIDVAR COL 40 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'SVRNAME: ' SVRVARD: ' COL 80 'DISK_READ: ' DSKVAR SKIP 2<br>BREAK ON SID SKIP PAGE<br>BTITLE OFF</p><p>SELECT SID,SVRNAME,PROCESS,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ROUND(DISK_READS/NVL(SA.EXECUTIONS,0),0) DISK_READ,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SQL_TEXT<br>&nbsp; FROM V$SQLTEXT ST, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; V$SQLAREA SA,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SELECT SE.PROCESS,SE.SID,SERIAL#,STATUS,USERNAME,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SVRNAME,SQL_HASH_VALUE<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM V$SESSION SE, SYSTEM.HMH_PS H<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE STATUS = 'ACTIVE'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND USERNAME != ' '<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND SE.PROCESS = H.PROCES(+)) SI<br>&nbsp;WHERE SI.SQL_HASH_VALUE = ST.HASH_VALUE<br>&nbsp;&nbsp; AND SI.SQL_HASH_VALUE = SA.HANS_VALUE<br>&nbsp;ORDER BY SID,PIECE<br>/<br>SPOOL OFF</p><p>[b][color=005511]SQL_10SEC.SQL ...&nbsp; Response time이 10초 이상인 SQL source [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;SQL_10SEC.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; List all SQL statements that have a response time more than 10 seconds<br>#<br>column nl newline;<br>set heading off<br>set pagesize 9999<br>set linesize 80&nbsp; <br>set echo off<br>set feedback off<br>set verify off<br>column runt format 999,999.99 newline;<br>spool diskread.sql </p><p>select&nbsp; ' ' nl,'doc' nl,translate(sql_text,'&amp;',':') nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '&nbsp; Expected Run Time = '||<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DISK_Reads / decode(executions,0,1,executions) / 50 runt,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '&nbsp; Executions = ' || executions nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '#' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'delete sys.han_table;' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'explain plan into sys.han_table for ' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql_text ||';' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="mailto:'@$HOME/mhan/plan">'@$HOME/mhan/plan</a> '<br>&nbsp; from v$sqlarea<br>&nbsp;where disk_reads / decode(executions,0,1,executions) / 50 &gt; 10<br>&nbsp;&nbsp; and upper(sql_text) not like '%BEGIN%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%SQLAREA%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%DBA_%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%USER_%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%ALL_%'<br>&nbsp;order by executions desc<br>/<br>spool off<br>spool bufget.sql<br>select&nbsp;&nbsp; ' ' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'doc' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; translate(sql_text,'&amp;',':') nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '&nbsp; Expected Run Time = '||<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buffer_gets / decode(executions,0,1,executions) / 500 runt,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '&nbsp; Executions = ' || executions nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '#' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'delete sys.han_table;' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'explain plan into sys.han_table for ' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql_text ||';' nl,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="mailto:'@$HOME/mhan/plan">'@$HOME/mhan/plan</a> '<br>&nbsp; from v$sqlarea<br>&nbsp;where buffer_gets / decode(executions,0,1,executions) / 500 &gt; 10<br>&nbsp;&nbsp; and upper(sql_text) not like '%BEGIN%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%SQLAREA%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%DBA_%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%USER_%'<br>&nbsp;&nbsp; and upper(sql_text) not like '%ALL_%'<br>&nbsp;order by executions desc<br>/<br>spool off<br>spool badstmt.lis<br>doc<br>&nbsp;&nbsp; got an excessive number of disk reads<br>#<br>@diskread.sql<br>doc<br>&nbsp;&nbsp; got an excessive number of scan through the buffer cache.<br>#<br>@bufget.sql<br>spool off</p><p>[b][color=005511]EXPLAIN.SQL ...&nbsp; Explain plan [/color][/b]</p><p>Doc<br>&nbsp;&nbsp; Name:&nbsp;EXPLAIN.sql<br>&nbsp;&nbsp; Author:&nbsp;Mahnho Han<br>&nbsp;&nbsp; Display execution plan<br>#&nbsp; <br>column operation format A30<br>column options format A20<br>column object_name format A28<br>set pages 80 <br>select lpad(' ',2*(level-1))||operation operation,options,object_name<br>&nbsp; from plan_table<br>&nbsp;start with id=0 and statement_id='han'<br>connect by prior id=parent_id and<br>statement_id = 'han';</p><p><br>&nbsp;</p></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
