<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[펌] ORA-01000: maximum open cursors exceeded</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2007-06-19 04:52:39</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[펌] ORA-01000: maximum open cursors exceeded</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">From : <a href="http://database.sarang.net/?inc=read&amp;aid=12590&amp;criteria=oracle&amp;subcrit=&amp;id=112&amp;limit=20&amp;keyword=v%24statement&amp;page=25">http://database.sarang.net/?inc=read&amp;aid=12590&amp;criteria=oracle&amp;subcrit=&amp;id=112&amp;limit=20&amp;keyword=v%24statement&amp;page=25</a><br><br><table class="infotable" style="TEXT-ALIGN: left" cellspacing="0" cellpadding="3" border="0"><tbody><tr><td class="rowtitle" colspan="6">[질문]ORA-01000: 최대 열기 커서 수를 초과했습니다 .</td></tr><tr><th class="infotable_th"><div style="WHITE-SPACE: nowrap">작성자</div></th><td class="rowmisc"><div style="WHITE-SPACE: nowrap">박진만</div></td><th class="infotable_th"><div style="WHITE-SPACE: nowrap">작성일</div></th><td class="rowmisc"><div style="WHITE-SPACE: nowrap">2002-11-15 16:06:12</div></td><th class="infotable_th"><div style="WHITE-SPACE: nowrap">조회수</div></th><td class="rowmisc" align="right"><div style="WHITE-SPACE: nowrap">2,077</div></td></tr></tbody></table><table class="viewtable" style="TEXT-ALIGN: left"><tbody><tr><td class="rowbody"><p>안녕하세요.</p><p>&nbsp;</p><p>저는 경상대학교에 재학중인 박진만이라고 합니다.</p><p>다름이 아니라, 클럽/동호회를 만드는데 생성시</p><p>데이터를 오라클 DB에 insert하고 Create하는 부분인데,,</p><p>무결성을 위해.. 12개를 처리하는데 이때 트랜젝션 처리를 합니다.</p><p>그러면 10개정도를 생성하고 Drop시킨후 다시 한 10개쯤 만들면</p><p>DB가 이상해집니다. 결국 15~6개 정도 만들면 아래와 같은 에러메세지가 나오고</p><p>결국은 오라클을 재부팅해야되는 결과가 나옵니다.</p><p>&nbsp;</p><p>다음과 같은 에러가 발생하는데 어떻게 해결해야 할런지요.</p><p>java.sql.SQLException: ORA-00604: 순환 SQL 레벨 1 에 오류가 발생했습니다 ORA-01000: 최대 열기 커서 수를 초과했습니다 .</p><p>많은 도움을 부탁드립니다.</p><p>&nbsp;</p><p>그리고 DB에 입력하는 부분의 소스를 첨부합니다.</p><p>몇일째 해결이 안되서 걱정입니다. </p><p>그럼 좋은 하루되시길바라며...,</p><p>&nbsp;</p><p>&lt; % @ page contentType="text/html; charset=euc-kr" import="java.sql.*, java.util.*" % &gt;</p><p>&lt; % @ page import="com.worlsys.lib.*" % &gt;</p><p>&nbsp;</p><p>&lt; %</p><p>String ip = request.getRemoteAddr();</p><p>String name = request.getParameter("name");</p><p>String url = request.getParameter("url");</p><p>int category = Integer.parseInt(request.getParameter("category"));</p><p>String desc = request.getParameter("desc");</p><p>String open = request.getParameter("open");</p><p>&nbsp;</p><p>//////////////////////////////////////////sysop_id , sysop 가져오기</p><p>String sysop = request.getParameter("sysop");</p><p>String sysop_id = "jmpark";</p><p>&nbsp;</p><p>String logo = name + " 클럽 입니다.";</p><p>String welcome = name + " 클럽에 오신걸 환영합니다.";</p><p>&nbsp;</p><p>DBConnectionManager dbMgr = null;</p><p>Connection conn = null;</p><p><span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span> stmt = null;</p><p>ResultSet rs = null;</p><p>Prepared<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span> pstmt = null;</p><p>&nbsp;</p><p>String tableName ="";</p><p>String sqlStr = "";</p><p>&nbsp;</p><p>try{</p><p>dbMgr = DBConnectionManager.getInstance();</p><p>conn = dbMgr.getConnection("jspDB");</p><p>&nbsp;</p><p>// 자동 커밋을 안되게</p><p>conn.setAutoCommit(false);</p><p>stmt = conn.create<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>();</p><p>//// Table [suw900tl] - 클럽정보 테이블</p><p>tableName = " SUW900TL ";</p><p>sqlStr = "insert into " + tableName + " ( suw900_no, suw900_name, suw900_url, suw900_category, suw900_date, suw900_sysop, suw900_membernum, suw900_open, suw900_desc, suw900_status, suw900_logo, suw900_welcome, suw900_grade, suw900_capacity, suw900_ip, suw900_curcapacity, suw900_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( suw900.nextval , ?, ?, ?, sysdate, ?, 1, ?, ?, '1', ?, ?, 4, 5, ?, 0, sysdate) ";</p><p>&nbsp;</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>&nbsp;</p><p>pstmt.setString(1, name);</p><p>pstmt.setString(2, url);</p><p>pstmt.setInt(3, category);</p><p>pstmt.setString(4, sysop);</p><p>pstmt.setString(5, open);</p><p>pstmt.setString(6, desc);</p><p>pstmt.setString(7, logo);</p><p>pstmt.setString(8, welcome);</p><p>pstmt.setString(9, ip);</p><p>&nbsp;</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>//// Table [suw920tl] - 클럽 가입 회원 테이블</p><p>// 클럽번호 가져오기</p><p>sqlStr = " select suw900_no from " + tableName + " where suw900_name='" + name + "'";</p><p>rs = stmt.executeQuery(sqlStr);</p><p>rs.next();</p><p>int clubno = rs.getInt("suw900_no");</p><p>rs.close();</p><p>stmt.close();</p><p>&nbsp;</p><p>tableName = " SUW920TL ";</p><p>sqlStr = "insert into " + tableName + " ( suw920_no, suw920_clubno, suw920_id, suw920_nickname, suw920_grade, suw920_open, suw920_status, suw920_date, suw920_ip, suw920_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( suw920.nextval , ?, ?, ?, 1, '1', '1', sysdate, ?, sysdate) ";</p><p>&nbsp;</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>&nbsp;</p><p>pstmt.setInt(1, clubno);</p><p>pstmt.setString(2, sysop_id);</p><p>pstmt.setString(3, sysop);</p><p>pstmt.setString(4, ip);</p><p>&nbsp;</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>//// Table [suw921tl] - 각 클럽 회원 등급 테이블</p><p>tableName = " SUW921TL ";</p><p>sqlStr = "insert into " + tableName + " ( suw921_no, suw921_name, suw921_clubno, suw921_date, suw921_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( 1, '시삽', "+ clubno +", sysdate, sysdate) ";</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>sqlStr = "insert into " + tableName + " ( suw921_no, suw921_name, suw921_clubno, suw921_date, suw921_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( 2, '부시삽', "+ clubno +", sysdate, sysdate) ";</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>sqlStr = "insert into " + tableName + " ( suw921_no, suw921_name, suw921_clubno, suw921_date, suw921_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( 3, '정회원', "+ clubno +", sysdate, sysdate) ";</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>sqlStr = "insert into " + tableName + " ( suw921_no, suw921_name, suw921_clubno, suw921_date, suw921_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( 4, '준회원', "+ clubno +", sysdate, sysdate) ";</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>//// Table [suw910tl] - 클럽 공지사항/게시판/자료실 정보(레이아웃) 등급 테이블</p><p>tableName = " SUW910TL ";</p><p>sqlStr = "insert into " + tableName + " ( suw910_no, suw910_clubno, suw910_name, suw910_class, suw910_seq, suw910_read, suw910_write, suw910_date, suw910_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( suw910.nextval, "+ clubno +", '공지사항', '1', 1, 4, 4,sysdate, sysdate) ";</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>sqlStr = "insert into " + tableName + " ( suw910_no, suw910_clubno, suw910_name, suw910_class, suw910_seq, suw910_read, suw910_write, suw910_date, suw910_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( suw910.nextval, "+ clubno +", '자유게시판', '2', 1, 4, 4,sysdate, sysdate) ";</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>sqlStr = "insert into " + tableName + " ( suw910_no, suw910_clubno, suw910_name, suw910_class, suw910_seq, suw910_read, suw910_write, suw910_date, suw910_updatedate ) ";</p><p>sqlStr = sqlStr + " values ( suw910.nextval, "+ clubno +", '자료실', '3', 1, 4, 4,sysdate, sysdate) ";</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>//// Table [suw911tl] - 전체 및 클럽 공지사항/게시판/자료실 테이블</p><p>tableName = " SUW911TL ";</p><p>sqlStr = "create sequence suw911_" + Integer.toString(clubno);</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>sqlStr = "create table suw911tl_" + Integer.toString(clubno);</p><p>sqlStr = sqlStr + " ( suw911_no number primary key not null, suw911_rel number not null, ";</p><p>sqlStr = sqlStr + " suw911_ord number not null, suw911_depth number not null, ";</p><p>sqlStr = sqlStr + " suw911_subject varchar2(50) not null, suw911_id varchar2(10), ";</p><p>sqlStr = sqlStr + " suw911_name varchar2(20), suw911_email varchar2(40), ";</p><p>sqlStr = sqlStr + " suw911_passwd varchar2(10), suw911_content1 varchar2(4000) not null, ";</p><p>sqlStr = sqlStr + " suw911_content2 varchar2(4000), suw911_savefile varchar2(100), ";</p><p>sqlStr = sqlStr + " suw911_realfile varchar2(100), suw911_date date default sysdate not null, ";</p><p>sqlStr = sqlStr + " suw911_readnum number default 0 not null, suw911_ip varchar2(15) not null, ";</p><p>sqlStr = sqlStr + " suw911_emailyesno char(1), suw911_htmlyesno char(1), ";</p><p>sqlStr = sqlStr + " suw911_filesize number default 0, suw911_updatedate date default sysdate, ";</p><p>sqlStr = sqlStr + " suw911_boardno number default 0 not null )";</p><p>&nbsp;</p><p>pstmt = conn.prepare<span style="FONT-WEIGHT: bold; COLOR: brown; BACKGROUND-COLOR: yellow">Statement</span>(sqlStr);</p><p>pstmt.executeUpdate();</p><p>pstmt.close();</p><p>&nbsp;</p><p>conn.commit();</p><p>&nbsp;</p><p>}catch(SQLException ex){</p><p>if( conn != null ) try { conn.rollback(); } catch(SQLException ex1) {}</p><p>out.println(ex.toString());</p><p>}catch(Exception ex){</p><p>if( conn != null ) try { conn.rollback(); } catch(SQLException ex1) {}</p><p>out.println(ex.toString());</p><p>}finally{</p><p>if ( conn != null ) try { conn.setAutoCommit(true); } catch(SQLException ex1) {}</p><p>if ( rs != null ) try { rs.close(); } catch(SQLException ex1) {}</p><p>if ( stmt != null ) try { stmt.close(); } catch(SQLException ex1) {}</p><p>if ( pstmt != null ) try { pstmt.close(); } catch(SQLException ex1) {}</p><p>if ( conn != null ) dbMgr.freeConnection("jspDB", conn);</p><p>&nbsp;</p><p>// out.print("&lt;meta http-equiv='refresh' content=0;URL=../index.jsp&gt;");</p><p>}</p><p>% &gt;</p></td></tr></tbody></table><div class="commenttitle">이 글에 대한 댓글이 총 1건 있습니다.<br><br></div><div class="commentrow"><div class="commentbody"><p>스크립트를 보질않고 에러결과만으로 유추해보면</p><p>결과수행 후 DB connection를 제대로 끊어주질 못하는듯...<br><br></p><p>SQL&gt;select * from v$session;</p><p>으로 실행 후 session이 없어지는지 LOCK이 잡히는지 확인해보시고</p><p>SQL&gt; show parameter processes</p><p>SQL&gt; show parameter open_cursors</p><p>로 너무작게 잡혀있는지 확인해보세요.</p></div><div class="commentinfo">kk님이 2002-11-16 11:24:17에 작성한 댓글입니다.</div></div></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
