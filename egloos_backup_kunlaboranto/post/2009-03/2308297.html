<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[펌] PE(Partition Exchange)를 이용해 대량의 Delete를 대신하기</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2009-03-27 15:46:43</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[펌] PE(Partition Exchange)를 이용해 대량의 Delete를 대신하기</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">From : http://www.egloos.com/egloo/insert.php?eid=e0040769 (욱짜<span style="font-family: Verdana;"><img src="http://forums.oracle.com/forums/images/status/ace_2.gif"></span><span style="font-family: Verdana;">님의 블로그)</span><br><br><h2><a style="" href="http://ukja.tistory.com/173">PE(Partition Exchange)를 이용해 대량의 Delete를 대신하기</a></h2>          <span class="name"><a href="http://ukja.tistory.com/category/Advanced%20Oracle">Advanced Oracle</a></span> <span class="date">2008/10/31 17:43</span><br>                     <p><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;">대량의 데이터에 대한 Delete 작업이 필요한 경우가 있다. 가령 다음과 같이...<br><br><span class="Apple-style-span" style="font-weight: bold;">Table t1의 Column c1 값이 1인 경우에 대해 모든 Data를 삭제하고 싶다.</span><br><br>하지만 이 경우 대량의 Undo와 Redo Data로 인해 심각한 성능 문제가 대두된다. 그래서 이런 경우 다음과 같은 방식이 권장되기도 한다.<br></span></span></span></span></p><ul style="list-style-type: square;"><li>Table t1의 Copy 본인 Table t2를 만든다.<br></li><li>Table t2에 Column c1 값이 1인 경우를 제외하고 Data를 Copy한다.<br></li><li>Table t1을 rename(혹은 drop)하고 Table t2를 t1으로 rename한다.<br></li><li>Index를 기존과 똑같은 이름으로 생성한다. <br></li></ul><p>위의 방법이 가끔 사용되기는 하지만 몇 가지 골치아픈 절차가 따른다. 가령 Index이름을 어떻게 맞추어 줄 것인가, Down Time을 어떻게 최소화시킬 것인가.... <br><br>이 경우에<span class="Apple-style-span" style="font-weight: bold;"> Partition Exchange</span>를 사용하면 좀 더 간편하게 동일한 목적을 달성할 수 있다. <br><br>아래 예제를 보자.<br><br>다음과 같은 Table t1이 있다.</p><div style="border: 1px dotted rgb(204, 204, 204); padding: 10px; background-color: rgb(255, 255, 255);"><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"></span><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><span style="font-family: 'Courier New';">create table t1(c1 int, c2 int);<br><br>alter table t1 add constraint t1_pk <br>primary key (c1, c2);<br><br>create index t1_n2 on t1(c2);<br><br>insert into t1 <br>select mod(level,5)+1, level<br>from dual<br>connect by level &lt;= 10000<br>;<br><br>select c1, count(*)<br>from t1<br>group by c1<br>;<br><br>C1 COUNT(*) <br>---------- ---------- <br>1 2000 <br>2 2000 <br>4 2000 <br>5 2000 <br>3 2000 </span></span></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><br><br></span></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;">우리의 목적은 Column c1의 값이 "1"인 경우의 Data를 모두 삭제하는 것이다. </span></span></span></span></div><div><span class="Apple-style-span" style="font-size: 13px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><br><br></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;">이를 위해서 Table t1의 복사본인 Table t2를 만든다. <br><br>단 Partition Exchange를 사용하기 위해 하나의 Partition으로 구성한다. Column c1 값이 1이 배제되도록 Data를 생성한다. 즉 Column c1의 값이 1인 경우가 삭제된 것과 동일하다.<br><br></span><div style="border: 1px dotted rgb(204, 204, 204); padding: 10px; background-color: rgb(255, 255, 255);"><span style="font-family: Verdana;"><span style="font-family: 'Courier New';">create table t2(c1, c2)<br>nologging<br>partition by range(c1) <br>(<br>partition p1 values less than(maxvalue)<br>) <br>as <br>select c1, c2 from t1<br>where c1 in (2, 3, 4, 5)<br>;<br></span></span></div><br><br></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><br>Partition Exchange를 위해 Index 구성도 통일시켜준다.<br></span></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><br><span style="font-family: 'Courier New';"><div style="border: 1px dotted rgb(204, 204, 204); padding: 10px; background-color: rgb(255, 255, 255);">create unique index t2_n1 on t2(c1, c2) local;<br><br>alter table t2 add constraint t2_pk <br>primary key (c1, c2) using index;<br><br>create index t2_n2 on t2(c2) local;</div></span><br></span><br></span></span></span></div><div><span class="Apple-style-span" style="font-size: 13px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-family: Verdana;"><font size="2">다음과 같이 Table t1과 Partition t2.p1을 Exchange한다.<br></font></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><br><span style="font-family: 'Courier New';"><div style="border: 1px dotted rgb(204, 204, 204); padding: 10px; background-color: rgb(255, 255, 255);">alter table t2<br>exchange partition p1<br>with table t1<br>including indexes<br>;</div></span><br></span><br></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;">Table t1에서 Column c1의 값이 1인 경우는 완전히 삭제되었다.<br></span></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><br><span style="font-family: 'Courier New';"><div style="border: 1px dotted rgb(204, 204, 204); padding: 10px; background-color: rgb(255, 255, 255);">select c1, count(*)<br>from t1<br>group by c1<br>;<br><br>C1 COUNT(*) <br>---------- ---------- <br>2 2000 <br>4 2000 <br>5 2000 <br>3 2000 </div></span><br><br>Table t2는 Table t1으로 교체되었으므로 모든 Data를 가지고 있다. </span></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><br><span style="font-family: 'Courier New';"><div style="border: 1px dotted rgb(204, 204, 204); padding: 10px; background-color: rgb(255, 255, 255);">select c1, count(*)<br>from t2<br>group by c1<br>;<br><br>C1 COUNT(*) <br>---------- ---------- <br>1 2000 <br>2 2000 <br>4 2000 <br>5 2000 <br>3 2000 </div></span><br><br></span><br><br></span></span></span></div><div><span class="Apple-style-span" style="font-size: 13px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-family: Verdana;"><font size="2">Index 또한 이름이 그대로 유지되며 VALID 상태를 유지한다.<br><br></font></span></span></div><div style="border: 1px dotted rgb(204, 204, 204); padding: 10px; background-color: rgb(255, 255, 255);"><div><span class="Apple-style-span" style="font-size: 13px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-family: Verdana;"><br></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span style="font-size: 11pt;"><span style="font-size: 10pt;"><span style="font-family: Verdana;"><br><span style="font-family: 'Courier New';">select index_name, status<br>from user_indexes<br>where table_name = 'T1'<br>;<br><br></span></span></span></span><span class="Apple-style-span" style="font-size: 13px;"><span style="font-family: Verdana;"><span style="font-family: 'Courier New';"><font size="2">INDEX_NAME STATUS <br>-------------------- ------------------------ <br>T1_PK VALID <br>T1_N2 VALID </font></span></span></span></span></div></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span class="Apple-style-span" style="font-size: 13px;"><span style="font-family: Verdana;"></span></span></span>&nbsp;</div><div><span class="Apple-style-span" style="font-size: 13px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><br><br></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span class="Apple-style-span" style="font-size: 13px;"><span style="font-family: Verdana;"><font size="2"><span class="Apple-style-span" style="font-weight: bold;">Partition Exchange</span>를 사용함으로써 훨씬 간단하게 원하는 바를 달성할 수 있다. </font></span></span></span></div><div><span class="Apple-style-span" style="font-size: 13px; color: rgb(0, 0, 0); line-height: normal; font-family: Verdana;"><br><br></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span class="Apple-style-span" style="font-size: 13px;"><span style="font-family: Verdana;"><font size="2">간단하지만 유용한 기법이라고 하겠다.</font></span></span></span></div><div><span class="Apple-style-span" style="font-size: 20px; color: rgb(0, 0, 0); line-height: normal; font-family: -webkit-monospace;"><span class="Apple-style-span" style="font-size: 13px;"><br></span></span></div><span id="callbacknestukjatistorycom173850" style="width: 1px; height: 1px; float: right;"><embed allowscriptaccess="always" id="bootstrapperukjatistorycom173850" src="http://ukja.tistory.com/plugin/CallBack_bootstrapperSrc?nil_profile=tistory&amp;nil_type=copied_post" wmode="transparent" type="application/x-shockwave-flash" enablecontextmenu="false" flashvars="&amp;callbackId=ukjatistorycom173850&amp;host=http://ukja.tistory.com&amp;embedCodeSrc=http%3A%2F%2Fukja.tistory.com%2Fplugin%2FCallBack_bootstrapper%3F%26src%3Dhttp%3A%2F%2Fcfs.tistory.com%2Fblog%2Fplugins%2FCallBack%2Fcallback%26id%3D173%26callbackId%3Dukjatistorycom173850%26destDocId%3Dcallbacknestukjatistorycom173850%26host%3Dhttp%3A%2F%2Fukja.tistory.com%26float%3Dleft" swliveconnect="true" width="1" height="1"></span><fieldset style="margin: 20px 0px; padding: 5px;"><legend><span><strong>크리에이티브 커먼즈 라이선스</strong></span></legend><!--Creative Commons License--><div style="float: left; width: 88px; margin-top: 3px;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/kr/" target="_blank"><img alt="Creative Commons License" style="border-width: 0pt;" src="http://i.creativecommons.org/l/by-nc-sa/2.0/kr/88x31.png"></a></div><div style="margin-left: 92px; margin-top: 3px; text-align: justify;">이 저작물은 <a style="" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/kr/" target="_blank">크리에이티브 커먼즈 코리아 저작자표시-비영리-동일조건변경허락 2.0 대한민국 라이선스</a>에 따라 이용하실 수 있습니다.<!-- Creative Commons License--><!-- <rdf:RDF xmlns="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><work rdf:about=""><license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/kr/" /></work><license rdf:about="http://creativecommons.org/licenses/by-nc-sa/"><permits rdf:resource="http://web.resource.org/cc/Reproduction"/><permits rdf:resource="http://web.resource.org/cc/Distribution"/><requires rdf:resource="http://web.resource.org/cc/Notice"/><requires rdf:resource="http://web.resource.org/cc/Attribution"/><permits rdf:resource="http://web.resource.org/cc/DerivativeWorks"/><requires rdf:resource="http://web.resource.org/cc/ShareAlike"/><prohibits rdf:resource="http://web.resource.org/cc/CommercialUse"/></license></rdf:RDF> --></div></fieldset><h4>'<a href="http://ukja.tistory.com/category/Advanced%20Oracle">Advanced Oracle</a>' 카테고리의 다른 글</h4><table><tbody><tr><th><a href="http://ukja.tistory.com/175">Oracle Library Cache를 이해하기 위한 숙제</a>&nbsp;&nbsp;<span>(1)</span></th><td>2008/11/09</td></tr><tr><th><a href="http://ukja.tistory.com/174">[새로쓴 대용량 데이터베이스 솔루션 I]을 보고 깜짝 놀라다.</a>&nbsp;&nbsp;<span>(9)</span></th><td>2008/11/01</td></tr><tr><th><a href="http://ukja.tistory.com/173" class="current">PE(Partition Exchange)를 이용해 대량의 Delete를 대신하기</a>&nbsp;&nbsp;<span>(11)</span></th><td>2008/10/31</td></tr><tr><th><a href="http://ukja.tistory.com/172">FIRST_ROWS vs. FIRST_ROWS_N 그리고 Cost의 개념</a>&nbsp;&nbsp;<span>(10)</span></th><td>2008/10/23</td></tr><tr><th><a href="http://ukja.tistory.com/171">11g is better  - 10046 Trace가 좋아졌다!!!</a>&nbsp;&nbsp;<span>(0)</span></th></tr></tbody></table><br><br>=======<br><ol><li>                                                  </li><li> <span><a style="" href="http://scidb.tistory.com/" onclick="return openLinkInNewWindow(this)">extremedb</a></span> <span>2008/11/02 17:50</span> <span><a href="http://ukja.tistory.com/173#" onclick="deleteComment(1209319);return false">Modify/Delete</a> <a href="http://ukja.tistory.com/173#" onclick="commentComment(1209319); return false">Reply</a></span>                          <p>아주 유용한 예제입니다.<br>PE 를 이런용도로도 사용하는 군요.^^<br>대용량 테이블일 경우 down time 을 더 낮추려면   Without Validation 을 적용하는것을 <br>추가적으로 고려해야 성능이 더욱 좋아질 것입니다.<br>물론 PE 될 테이블의 데이터가 이미 VALID 된 상태라고 가정하고 말입니다.<br>좋은글 감사합니다.</p>                                                  </li><li> <span>Stargazer</span> <span>2008/11/03 09:46</span> <span><a href="http://ukja.tistory.com/173#" onclick="deleteComment(1210875);return false">Modify/Delete</a> <a href="http://ukja.tistory.com/173#" onclick="commentComment(1210875); return false">Reply</a></span>                          <p>생각의 전환...역시...대단하십니다..</p>                                                  </li><li> <span>백면서생</span> <span>2008/11/03 16:27</span> <span><a href="http://ukja.tistory.com/173#" onclick="deleteComment(1211905);return false">Modify/Delete</a> <a href="http://ukja.tistory.com/173#" onclick="commentComment(1211905); return false">Reply</a></span>                          <p>좋은 글 잘 봤습니다.~</p>                                                  </li><li> <span>oracler</span> <span>2008/11/08 08:58</span> <span><a href="http://ukja.tistory.com/173#" onclick="deleteComment(1235367);return false">Modify/Delete</a> <a href="http://ukja.tistory.com/173#" onclick="commentComment(1235367); return false">Reply</a></span>                          <p>오...이런,, 좋으네요 그냥 대단하시다는 말밖에 안나옵니다.<br><br>그런데 전통적인 위의 방법에서 인덱스 이름 맟추기와 다운타임 최소화가<br>왜 문제가 되는지 모르겠네요 ?<br>결국 alter index rename 과 drop, rename 시간인데 <br>인덱스 이름 맟추는것도 문제가 없으며 모두 금방 끝나는거 아닌가여</p>                                                  </li><li> <span><a href="http://ukja.tistory.com/" onclick="return openLinkInNewWindow(this)">욱짜</a></span> <span>2008/11/08 11:35</span> <span><a href="http://ukja.tistory.com/173#" onclick="deleteComment(1235523);return false">Modify/Delete</a> <a href="http://ukja.tistory.com/173#" onclick="commentComment(1235523); return false">Reply</a></span>                          <p>인덱스 이름의 경우 전통적인 방법에 비해서 좀 더 편하다 정도로 이해하시면 될 거 같습니다. 수동으로 인덱스 이름을 맞추어주는 경우 오타 등으로 인해 생각지 못한 문제가 발생하는 경우가 종종 있습니다. <br><br>Down Time의 경우에는 DML을 Blocking하는 DDL Operation의 회수가 여러번에서 1번으로 줄어든다 정도의 의미로 이해하시면 될 거 같습니다. 이로 인해 시간이 크게 절약된다는 의미는 아니구요.</p></li></ol><br></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
