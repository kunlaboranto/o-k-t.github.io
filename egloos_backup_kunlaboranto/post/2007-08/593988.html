<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[펌] create temporary tablespace차이점 알고싶습니다.</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">kun</strong> 님 (<strong class="name">okseop7</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2007-08-27 23:32:53</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[펌] create temporary tablespace차이점 알고싶습니다.</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">From : http://database.sarang.net/?inc=read&amp;aid=22762&amp;criteria=oracle&amp;subcrit=&amp;id=&amp;limit=20&amp;keyword=dba_tables&amp;page=2<br><br><p>1. create temporary tablespace TEMP01</p><p>tempfile '/oradata/temp01_01.dbf' size 1G;</p><p>&nbsp;</p><p>2. create tablespace TEMP01</p><p>datafile '/oradata/temp01_01.dbf' size 1G temporary;</p><p>&nbsp;</p><p>1,2번 명령어 둘다 temporary tablespace를 생성하는 방법인걸로알고잇는데요?</p><p>혹시 차이점이 있나요?????</p><p><br></p><p>======================================</p><div class="commentbody"><p>퍼온자료입니다. </p><p>&nbsp;</p><p>=========================================================</p><p>TEMPORARY TABLESPACE에서 TEMPFILE 과 DATAFILE의 차이점 (8.1.X ~ 9I) <br>============================================================ </p><p><br>PURPOSE <br>------- <br>이 문서에서는 Oracle 7.3부터 사용되어 오던 create tablespace ... temporary <br>형태와, 8i부터 사용되는 create temporary tablespace... 의 차이점을 정리해 <br>본다. <br>tablespace의 temporay type과 permanent type에 대한 비교는 &lt;Bulletin#: 11938&gt; <br>를 참조하도록 하고 여기에서는 permanent에 대해서는 논외로 한다. </p><p><br>Explanation <br>----------- <br>temporary segment가 생성 가능한 tablespace의 type과 temporary tablesapce에서 <br>datafile과 tempfile의 차이점을 설명한다. </p><p>1. temporary segment를 생성가능한 tablespace type 정리 </p><p>temporary tablespace의 tempfile과 datafile을 비교하기 전에, tablespace의 <br>type들을 확인해 보고, 이 중 temporary segment가 생성될 수 있는 tablespace <br>type을 version별로 정리해본다. </p><p>tablespace는 7.2까지는 permanent type으로 dictionary managed방식으로 <br>space를 할당/해제하던 방식만이 존재했다. db user의 temporary tablespace로 <br>임의의 tablespace를 지정가능하였고, 해당 db user의 sort operation은 <br>지정된 tablespace에서 발생하며, 다른 tablespace와 특별히 구분되는 것은 <br>없었다. </p><p>이후, 7.3에 temporary type이 추가되고, 8i에서 locally managed type과 일반 <br>datafile이 아닌 tempfile이 소개되면서 8i를 기준으로 기본적으로 다음과 같이 <br>4가지 형태의 tablespace 형태가 가능하다. <br>이중 (1) ~ (3)번까지는 일반 datafile형태이고, (4)번의 경우는 이 문서에서 <br>자세히 살펴볼 tempfile이다. <br>(locally managed와 dictionary managed의 차이점 및 사용 방법은 <br>&lt;Bulletin #: 18261&gt;과 &lt;Bulletin #: 11860&gt; 참조) </p><p>&nbsp; (1) permanent-dictionary managed <br>&nbsp; (2) permanent-locally managed <br>&nbsp; (3) temporary-dictionary managed <br>&nbsp; (4) tempfile-locally managed </p><p>[주의] 위의 종류에 temporary datafile에 locally managed 형태의 tablespace는 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 없는것에 주의한다. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 그리고 만약 system tablespace가 locally managed로 이미 생성된 경우에는 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 이후 모든 tablespace는 locally managed로 생성이 가능하고, dictionary <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; managed 형태는 생성하면 ORA-12913 (Cannot create dictionary managed <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablespace) 오류가 발생하게 된다. </p><p><br>이러한 여러가지 type의 tablespace중 temporary segment를 생성할 수 있는 <br>tablespace에 제약이 존재한다. </p><p>- 8i: 어떠한 형태의 tablespace라도 db user의 temporary tablespace로 지정 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 가능하다. 단, permanent-locally managed 형태의 tablespace에 sort가 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 발생하게 되면 ORA-3212 (Temporary Segment cannot be created in <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; locally-managed tablespace) 오류가 발생하게 된다. </p><p><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; alter user scott temporary tablespace PERM_LOCAL; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; User altered. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connect scott/tiger <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; select * from dept order by 1; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORA-03212: Temporary Segment cannot be created in locally-managed <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablespace <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>- 9i: db user의 default temporary tablespace 지정 자체가 다음 두 가지 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type만이 가능한다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -temporary-dictionary managed <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -tempile-locally managed <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 만약 permanent type의 tablespace를 db user의 tempoary tablespace로 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 지정하면, ORA-12911 (permanent tablespace cannot be temporary tablespace) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 오류가 발생한다. </p><p><br>2. tempfile과 datafile의 비교 </p><p>아래에서 tablespace지정시 tempfile과 datafile형태를 비교하게 되는데, <br>단, datafile형태의 경우 permanent type에 대해서는 언급하지 않는다. </p><p>(1) tempile의 특징 </p><p>&nbsp;&nbsp;&nbsp; Oracle7.3에서 tablespace에 생성시 temporary option을 이용하여 생성되는 <br>&nbsp;&nbsp;&nbsp; tablespace를 구성하는 화일은 datafile이다. 단지 이것이 기존의 permanent <br>&nbsp;&nbsp;&nbsp; type과 구별되는것은 이 tablespace에 생성되는 segment들이 매번 sort <br>&nbsp;&nbsp;&nbsp; operation마다 별도로 생성되는 대신, 하나의 segment로 만들어지면서 <br>&nbsp;&nbsp;&nbsp; 다른 session에서의 sort operation이 같은 segment를 공유하는 것이다. <br>&nbsp;&nbsp;&nbsp; (자세한 것은 &lt;Bulletin#: 11938&gt; 참조) <br>&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; Oracle8.1부터 추가된 tempfile형태의 중요한 특징은 tempfile에 발생하는 <br>&nbsp;&nbsp;&nbsp; 변경사항은 redo log file에 기록되지 않는다는 것이다. tempfile에 <br>&nbsp;&nbsp;&nbsp; checkpoint정보도 기록하지 않고 이에 따라 datafile recovery시에도 <br>&nbsp;&nbsp;&nbsp; tempfile에 대해서는 recovery가 필요없게 된다. <br>&nbsp;&nbsp;&nbsp; 이와 같은 이유로 standby database에서 read-only mode로 open하고 <br>&nbsp;&nbsp;&nbsp; 조회시 sort가 발생하여 tempfile이 변경되는것은 문제가 되지 않아 <br>&nbsp;&nbsp;&nbsp; 사용이 가능하다. </p><p>&nbsp;&nbsp;&nbsp; 그리고 이미 앞에서 설명한 것과 같이 tempfile은 항상 locally managed <br>&nbsp;&nbsp;&nbsp; type으로만 생성이 되며, datafile형태의 temporary tablespace는 다음과 <br>&nbsp;&nbsp;&nbsp; 같이 locally managed type으로 생성 자체가 불가능하다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; create tablespace temp_datafile_local <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp; DATAFILE '/ora/oradata/V920/temp_data.dbf' size 100M <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp; TEMPORARY <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp; EXTENT MANAGEMENT LOCAL UNIFORM SIZE 128K; <br>&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp; ORA-25144: invalid option for CREATE TABLESPACE with TEMPORARY contents <br>&nbsp;&nbsp;&nbsp;&nbsp; </p><p>(2) temporary tablespace 생성 방법 비교 </p><p>&nbsp; - tempfile형태의 경우 <br>&nbsp;&nbsp;&nbsp; tempfile로 temporary tablespace를 생성하는 경우는 다음과 같이 <br>&nbsp;&nbsp;&nbsp; 생성하여야 하며, 반드시 locally managed 형태로만 생성 가능하다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt;&nbsp; create TEMPORARY tablespace temp_tempfile_local <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp; TEMPFILE '/ora/V920/temp_temp.dbf' size 100M <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp; EXTENT MANAGEMENT LOCAL UNIFORM SIZE 128K; </p><p>&nbsp;&nbsp;&nbsp; 아래 명령어에서 3번 line을 제거하고 생성하여도 default로 locally <br>&nbsp;&nbsp;&nbsp; managed로 생성이 되며, dictionary managed 형태로 생성하고자 <br>&nbsp;&nbsp;&nbsp; 3번 line대신 storage option을 추가하면 <br>&nbsp;&nbsp;&nbsp; ORA-2180 (invalid option for CREATE TABLESPACE) 오류가 발생한다. </p><p>&nbsp; - datafile형태의 경우&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; 다음과 같은 형태로 생성하게 되면, dictionary managed type의 <br>&nbsp;&nbsp;&nbsp; temporary datafile형태로 tablespace가 만들어진다. 단, 9i의 경우 <br>&nbsp;&nbsp;&nbsp; 이미 앞에서 언급한대로 system tablespace가 locally managed인 경우에는 <br>&nbsp;&nbsp;&nbsp; 이와 같은 dictionary managed tablespace 생성은 ORA-12913이 발생하면서 <br>&nbsp;&nbsp;&nbsp; 불가능하게 된다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; create tablespace temp_datafile_dict <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; datafile '/ora/oradata/V920/temp_data.dbf' size 100M <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; TEMPORARY; </p><p>(3) dictionary view 의 차이 </p><p>&nbsp;&nbsp;&nbsp; 먼저 <span style="color: brown; background-color: yellow; font-weight: bold;">dba_tables</span>paces를 통해 <br>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; select tablespace_name, contents, extent_management, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allocation_type from <span style="color: brown; background-color: yellow; font-weight: bold;">dba_tables</span>paces; </p><p>&nbsp;&nbsp;&nbsp;&nbsp; TABLESPACE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CONTENTS&nbsp; EXTENT_MAN&nbsp;&nbsp; ALLOCATIO <br>&nbsp;&nbsp;&nbsp;&nbsp; ------------------------ ---------&nbsp; ----------&nbsp; --------- <br>&nbsp;&nbsp;&nbsp;&nbsp; TEMP_TEMPFILE_LOCAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TEMPORARY LOCAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UNIFORM <br>&nbsp;&nbsp;&nbsp;&nbsp; TEMP_DATAFILE_DICT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TEMPORARY DICTIONARY </p><p>&nbsp; - tempfile의 경우 </p><p>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; select STATUS, ENABLED, NAME from v$tempfile; </p><p>&nbsp;&nbsp;&nbsp;&nbsp; STATUS&nbsp; ENABLED&nbsp;&nbsp;&nbsp; NAME <br>&nbsp;&nbsp;&nbsp;&nbsp; ------- ---------- ---------------------------------- <br>&nbsp;&nbsp;&nbsp;&nbsp; ONLINE&nbsp; READ WRITE /ora/V920/temp_temp.dbf </p><p>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; select FILE_NAME, TABLESPACE_NAME from dba_temp_files; </p><p>&nbsp;&nbsp;&nbsp;&nbsp; FILE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TABLESPACE_NAME&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp; ------------------------------------ ------------------- <br>&nbsp;&nbsp;&nbsp;&nbsp; /ora/V920/temp_temp.dbf&nbsp; TEMP_TEMPFILE_LOCAL </p><p><br>&nbsp; - datafile 형태의 경우 </p><p>&nbsp;&nbsp;&nbsp; 다음과 같이 v$datafile과 dba_data_files를 통해 조회한다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; select STATUS, ENABLED, NAME from v$datafile; </p><p>&nbsp;&nbsp;&nbsp;&nbsp; STATUS&nbsp; ENABLED&nbsp;&nbsp;&nbsp; NAME <br>&nbsp;&nbsp;&nbsp;&nbsp; ------- ---------- ---------------------------------- <br>&nbsp;&nbsp;&nbsp;&nbsp; ONLINE&nbsp; READ WRITE /ora/oradata/V920/temp_data.dbf </p><p>&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; select FILE_NAME, TABLESPACE_NAME from dba_data_files; </p><p>&nbsp;&nbsp;&nbsp;&nbsp; FILE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TABLESPACE_NAME&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp; ------------------------------------ ------------------- <br>&nbsp;&nbsp;&nbsp;&nbsp; /ora/oradata/V920/temp_data.dbf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TEMP_DATAFILE_DICT </p><p><br>(4) tempfile의 삭제에 대해서 </p><p>&nbsp;&nbsp;&nbsp; datafile의 경우 tablespace를 삭제하지 않고 datafile만 삭제하는 방법은 <br>&nbsp;&nbsp;&nbsp; 존재하지 않는다. 물론 alter database datafile 'filename' offline drop; <br>&nbsp;&nbsp;&nbsp; 과 같은 command가 있지만 이것도 datafile을 데이타베이스에서 지워주는 <br>&nbsp;&nbsp;&nbsp; 것이 아니며 이렇게 offline drop된 datafile을 포함하는 tablespace는 <br>&nbsp;&nbsp;&nbsp; recovery가 불가능한 경우라면 tablespace자체를 삭제해야 한다. </p><p>&nbsp;&nbsp;&nbsp; 그런데 tempfile의 경우는 temporary tablespace는 그대로 유지한 채, <br>&nbsp;&nbsp;&nbsp; tempfile만 삭제하는 것이 가능하다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; alter database tempfile '/oradata/V817/temp_temp01.dbf' <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; drop; <br>&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; 8i의 경우라면 이와 같은 명령어 후 실제 directory로 이동하여 직접 <br>&nbsp;&nbsp;&nbsp; tmep_temp01.dbf를 삭제하여야 한다. </p><p>&nbsp;&nbsp;&nbsp; 9i에서는 drop뒤에 including datafiles 라는 option을 추가하여 tempfile의 <br>&nbsp;&nbsp;&nbsp; drop시 바로 os상에서도 삭제되도록 할 수 있다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; alter database tempfile '/oradata/V817/temp_temp01.dbf' <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; drop including contents; </p><p>&nbsp;&nbsp;&nbsp; 만약 이러한 방법으로, tempfile을 해당 temporary tablespace에서 모두 <br>&nbsp;&nbsp;&nbsp; 삭제한 경우, 실제 해당 tablespace에 disk sort가 필요하게 되면, <br>&nbsp;&nbsp;&nbsp; 그때는 ORA-25153 (Temporary Tablespace is Empty) 오류가 발생하게 된다. </p><p>&nbsp;&nbsp;&nbsp; 이때는 다음과 같이 임의의 tempfile을 다시 추가할 수 있다. </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SQL&gt; alter tablespace TEMP_TEMPFILE_LOCAL <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; add tempfile '/oradata/V817/temp_temp02.dbf'; </p></div>^^님이 2005-05-24 16:34:08에 작성한 댓글입니다<br></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
